<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TablÃ³n de anuncios anÃ³nimos</title>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background-color: #f9f9f9;
            --text-color: #333333;
            --header-bg: #ffffff;
            --counter-bg: #ffffff;
            --button-bg: #4caf50;
            --button-text: #ffffff;
            --border-color: #ff6f61;
        }

        body.dark-mode {
            --background-color: #121212;
            --text-color: #ffffff;
            --header-bg: #1e1e1e;
            --counter-bg: #333333;
            --button-bg: #bb86fc;
            --button-text: #000000;
            --border-color: #8e9eab;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Comfortaa', cursive;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            background-color: var(--header-bg);
            padding: 20px 0;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            margin: 0;
            font-size: 32px;
            color: #ff6347;
        }

        #slogan {
            background-color: #ffff00;
            color: #000000;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
        }

        #theme-toggle {
            margin-top: 10px;
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
        }

        .container {
            display: flex;
            flex-direction: column;
            padding: 10px;
            width: 100%;
            max-width: 800px;
        }

        .counters {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .counter {
            background-color: var(--counter-bg);
            padding: 10px;
            border-radius: 5px;
            font-size: 16px;
        }

        #message-form {
            background-color: var(--header-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #message-form textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            resize: vertical;
            font-size: 16px;
            font-family: 'Comfortaa', cursive;
        }

        #message-form button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background-color: var(--button-bg);
            color: var(--button-text);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            font-family: 'Comfortaa', cursive;
            font-weight: bold;
        }

        #bulletin-board {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            border-radius: 15px;
            position: relative;
            background-clip: padding-box;
            overflow: hidden;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            border: 2px solid var(--border-color);
        }

        .message::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; bottom: -2px; right: -2px;
            background: linear-gradient(45deg, var(--border-color), #de6262);
            z-index: -1;
            border-radius: 15px;
        }

        .message-emoji {
            font-size: 48px;
            margin-right: 15px;
        }

        .message-content {
            flex: 1;
        }

        .message-text {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .message-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .like-btn, .dislike-btn, .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
        }

        .like-btn:hover, .dislike-btn:hover, .delete-btn:hover {
            transform: scale(1.2);
            transition: transform 0.2s;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .floating-emoji {
            position: fixed;
            font-size: 30px;
            animation: float 3s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }
    </style>
</head>
<body>
    <header>
        <h1>TablÃ³n de anuncios anÃ³nimos</h1>
        <div id="slogan"></div>
        <button id="theme-toggle">ðŸŒ“</button>
    </header>
    <div class="container">
        <div class="counters">
            <div class="counter" id="days-operating">DÃ­as en funcionamiento: 0</div>
            <div class="counter" id="messages-published">Mensajes publicados: 0</div>
        </div>
        <form id="message-form">
            <textarea id="message-input" placeholder="Escribe tu mensaje aquÃ­..."></textarea>
            <button type="submit">Publicar</button>
        </form>
        <div id="bulletin-board"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script>
        // ConfiguraciÃ³n de Firebase (usa tu propia configuraciÃ³n)
        const firebaseConfig = {
            apiKey: "AIzaSyBlIRJVI1buU48SPp0ErpCXhnuBdBEp8rk",
            authDomain: "tablon-de-anuncios-d5dea.firebaseapp.com",
            projectId: "tablon-de-anuncios-d5dea",
            storageBucket: "tablon-de-anuncios-d5dea.appspot.com",
            messagingSenderId: "67910184237",
            appId: "1:67910184237:web:e43d424657a948ae5d77a4",
            measurementId: "G-YL5W1VNM9Z"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const bulletinBoard = document.getElementById('bulletin-board');
        const messageForm = document.getElementById('message-form');
        const messageInput = document.getElementById('message-input');
        const messagesPublished = document.getElementById('messages-published');
        const themeToggle = document.getElementById('theme-toggle');
        const daysOperating = document.getElementById('days-operating');
        const slogan = document.getElementById('slogan');

        const animalEmojis = ['ðŸ¶', 'ðŸ±', 'ðŸ­', 'ðŸ¹', 'ðŸ°', 'ðŸ¦Š', 'ðŸ»', 'ðŸ¼', 'ðŸ¨', 'ðŸ¯', 'ðŸ¦', 'ðŸ®', 'ðŸ·', 'ðŸ¸', 'ðŸµ', 'ðŸ”', 'ðŸ§', 'ðŸ¦', 'ðŸ¦†', 'ðŸ¦…', 'ðŸ¦‰', 'ðŸ¦‡', 'ðŸº', 'ðŸ—', 'ðŸ´', 'ðŸ¦„', 'ðŸ', 'ðŸ›', 'ðŸ¦‹', 'ðŸŒ', 'ðŸž', 'ðŸœ', 'ðŸ¦Ÿ', 'ðŸ¦—', 'ðŸ•·', 'ðŸ¦‚', 'ðŸ¦€', 'ðŸ', 'ðŸ¦Ž', 'ðŸ¦–', 'ðŸ¦•', 'ðŸ™', 'ðŸ¦‘', 'ðŸ¦', 'ðŸ¦ž', 'ðŸ¦€', 'ðŸ³', 'ðŸ¬', 'ðŸŸ', 'ðŸ ', 'ðŸ¡', 'ðŸ¦ˆ', 'ðŸŠ', 'ðŸ…', 'ðŸ†', 'ðŸ¦“', 'ðŸ¦', 'ðŸ¦§', 'ðŸ˜', 'ðŸ¦›', 'ðŸ¦', 'ðŸª', 'ðŸ«', 'ðŸ¦’', 'ðŸ¦˜', 'ðŸƒ', 'ðŸ‚', 'ðŸ„', 'ðŸŽ', 'ðŸ–', 'ðŸ', 'ðŸ‘', 'ðŸ¦™', 'ðŸ', 'ðŸ¦Œ', 'ðŸ•', 'ðŸ©', 'ðŸ¦®', 'ðŸ•â€ðŸ¦º', 'ðŸˆ', 'ðŸˆâ€â¬›', 'ðŸ“', 'ðŸ¦ƒ', 'ðŸ¦š', 'ðŸ¦œ', 'ðŸ¦¢', 'ðŸ¦©', 'ðŸ•Š', 'ðŸ‡', 'ðŸ¦', 'ðŸ¦¨', 'ðŸ¦¡', 'ðŸ¦¦', 'ðŸ¦¥', 'ðŸ', 'ðŸ€', 'ðŸ¿', 'ðŸ¦”'];

        const slogans = [
            "Ahora mÃ¡s anÃ³nimo",
            "Lo nunca visto",
            "Publica sin miedo",
            "Cuidado, no se pueden borrar",
            "Tu voz, tu espacio",
            "Comparte libremente",
            "Ideas sin lÃ­mites",
            "El muro digital",
            "ExprÃ©sate sin barreras",
            "Tu mensaje importa",
            "La pÃ¡gina favorita de Moncho",
            "CÃ³mprate un Maichi",
            "Donde tus ideas vuelan alto",
            "Tu rincÃ³n secreto",
            "AnÃ³nimamente genial",
            "Comparte sin filtros",
            "Tu espacio, tus reglas",
            "Publica y desaparece",
            "El lugar de tus pensamientos",
            "Dilo todo sin miedo",
            "AnÃ³nimos pero presentes",
            "Donde todo es posible",
            "Tu voz en el viento",
            "Expresiones sin fronteras",
            "Donde nadie te juzga",
            "Tu espacio invisible",
            "Publica y deja que fluya"
        ];

        // Lista de colores de fondo que contrastan bien con el texto
        const bgColorsLight = [
            '#FFCDD2', '#C8E6C9', '#BBDEFB', '#FFF9C4', '#D1C4E9',
            '#F0F4C3', '#FFECB3', '#B2DFDB', '#DCEDC8', '#FFE0B2',
            '#F8BBD0', '#C5CAE9', '#B3E5FC', '#D7CCC8', '#F0F4C3',
            '#FFE0B2', '#FFCCBC', '#D7CCC8', '#E1BEE7', '#C8E6C9'
        ];

        const bgColorsDark = [
            '#B71C1C', '#1B5E20', '#0D47A1', '#F57F17', '#4A148C',
            '#33691E', '#FF6F00', '#006064', '#004D40', '#BF360C',
            '#880E4F', '#283593', '#01579B', '#3E2723', '#1B5E20',
            '#D84315', '#004D40', '#1A237E', '#004D40', '#3E2723'
        ];

        // Referencia a la colecciÃ³n metadata y al documento especÃ­fico
        const metadataDocRef = db.collection('metadata').doc('general');

        let startDate = null;
        let totalMessages = 0;

        // Escuchar cambios en metadata
        metadataDocRef.onSnapshot((doc) => {
            if (doc.exists) {
                const data = doc.data();
                if (data.startDate && data.startDate.toDate) {
                    startDate = data.startDate.toDate();
                    updateDaysOperating();
                }
                if (data.totalMessages !== undefined) {
                    totalMessages = data.totalMessages;
                    updateMessagesPublishedDisplay();
                }
            }
        }, (error) => {
            console.error("Error al escuchar metadata: ", error);
        });

        // Inicializar metadata si no existe
        metadataDocRef.get().then((doc) => {
            if (!doc.exists) {
                const now = firebase.firestore.FieldValue.serverTimestamp();
                metadataDocRef.set({
                    startDate: now,
                    totalMessages: 0
                }).then(() => {
                    console.log("Metadata inicial establecida.");
                }).catch((error) => {
                    console.error("Error al establecer metadata inicial: ", error);
                });
            }
        }).catch((error) => {
            console.error("Error al obtener metadata: ", error);
        });

        function updateDaysOperating() {
            if (!startDate) return;
            const today = new Date();
            // Calcular la diferencia en dÃ­as
            const timeDiff = today - startDate;
            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24)) + 1;
            daysOperating.textContent = `DÃ­as en funcionamiento: ${days}`;
        }

        function updateMessagesPublishedDisplay() {
            messagesPublished.textContent = `Mensajes publicados: ${totalMessages}`;
        }

        // Escuchar cambios en los mensajes
        function loadMessages() {
            db.collection("messages").orderBy("timestamp", "desc").onSnapshot((querySnapshot) => {
                bulletinBoard.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const message = doc.data();
                    createMessageElement(message, doc.id);
                });
            }, (error) => {
                console.error("Error al cargar los mensajes: ", error);
            });
        }

        function createMessageElement(message, id) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.dataset.id = id;

            // Asignar un color de fondo aleatorio que contraste
            const isDarkMode = document.body.classList.contains('dark-mode');
            const bgColor = isDarkMode 
                ? bgColorsDark[Math.floor(Math.random() * bgColorsDark.length)]
                : bgColorsLight[Math.floor(Math.random() * bgColorsLight.length)];
            messageDiv.style.backgroundColor = bgColor;

            const emoji = document.createElement('div');
            emoji.className = 'message-emoji';
            emoji.textContent = message.emoji;

            const content = document.createElement('div');
            content.className = 'message-content';

            const text = document.createElement('div');
            text.className = 'message-text';
            text.textContent = message.text;

            const actions = document.createElement('div');
            actions.className = 'message-actions';

            const likeBtn = document.createElement('button');
            likeBtn.className = 'like-btn';
            likeBtn.textContent = `ðŸ‘ ${message.likes || 0}`;
            likeBtn.onclick = () => updateLikes(id, 'likes');

            const dislikeBtn = document.createElement('button');
            dislikeBtn.className = 'dislike-btn';
            dislikeBtn.textContent = `ðŸ‘Ž ${message.dislikes || 0}`;
            dislikeBtn.onclick = () => updateLikes(id, 'dislikes');

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.textContent = 'ðŸ—‘ï¸';
            deleteBtn.onclick = () => deleteMessage(id);

            actions.appendChild(likeBtn);
            actions.appendChild(dislikeBtn);
            actions.appendChild(deleteBtn);

            content.appendChild(text);
            content.appendChild(actions);

            messageDiv.appendChild(emoji);
            messageDiv.appendChild(content);

            bulletinBoard.appendChild(messageDiv);
        }

        function updateLikes(id, field) {
            db.collection("messages").doc(id).update({
                [field]: firebase.firestore.FieldValue.increment(1)
            })
            .then(() => {
                console.log(`Actualizado ${field} para el mensaje ${id}.`);
            })
            .catch((error) => {
                console.error(`Error al actualizar ${field}: `, error);
            });
        }

        function deleteMessage(id) {
            if (confirm("Â¿EstÃ¡s seguro de que quieres borrar este mensaje?")) {
                db.collection("messages").doc(id).delete()
                .then(() => {
                    console.log(`Mensaje ${id} borrado correctamente.`);
                })
                .catch((error) => {
                    console.error("Error al borrar el mensaje: ", error);
                });
            }
        }

        messageForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const text = messageInput.value.trim();
            if (text) {
                const message = {
                    text: text,
                    emoji: getRandomAnimalEmoji(),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    likes: 0,
                    dislikes: 0
                };
                db.collection("messages").add(message)
                .then(() => {
                    messageInput.value = '';
                    incrementTotalMessages();
                })
                .catch((error) => {
                    console.error("Error al publicar el mensaje: ", error);
                });
            }
        });

        function getRandomAnimalEmoji() {
            return animalEmojis[Math.floor(Math.random() * animalEmojis.length)];
        }

        function incrementTotalMessages() {
            metadataDocRef.update({
                totalMessages: firebase.firestore.FieldValue.increment(1)
            })
            .then(() => {
                console.log("Contador de mensajes incrementado.");
            })
            .catch((error) => {
                console.error("Error al incrementar el contador de mensajes: ", error);
            });
        }

        function changeSlogan() {
            slogan.textContent = slogans[Math.floor(Math.random() * slogans.length)];
        }

        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            themeToggle.textContent = document.body.classList.contains('dark-mode') ? 'ðŸŒž' : 'ðŸŒ“';
        });

        function createEmojiBackground() {
            const emojiContainer = document.createElement('div');
            emojiContainer.style.position = 'fixed';
            emojiContainer.style.top = '0';
            emojiContainer.style.left = '0';
            emojiContainer.style.width = '100%';
            emojiContainer.style.height = '100%';
            emojiContainer.style.pointerEvents = 'none';
            emojiContainer.style.zIndex = '-1';

            for (let i = 0; i < 50; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'floating-emoji';
                emoji.textContent = getRandomAnimalEmoji();
                emoji.style.left = `${Math.random() * 100}vw`;
                emoji.style.top = `${Math.random() * 100}vh`;
                emoji.style.animationDuration = `${Math.random() * 3 + 2}s`;
                emoji.style.animationDelay = `${Math.random() * 2}s`;
                emojiContainer.appendChild(emoji);
            }

            document.body.appendChild(emojiContainer);
        }

        function initApp() {
            loadMessages();
            changeSlogan();
            createEmojiBackground();

            // Actualizar dÃ­as en funcionamiento cada dÃ­a a medianoche
            const now = new Date();
            const millisTillMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1, 0,0,0,0) - now;
            setTimeout(function(){
                updateDaysOperating();
                setInterval(updateDaysOperating, 1000 * 60 * 60 * 24);
            }, millisTillMidnight);

            // Cambiar el slogan cada 10 segundos
            setInterval(changeSlogan, 10000);
        }

        window.onload = initApp;
    </script>
</body>
</html>