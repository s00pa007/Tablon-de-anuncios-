<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Emoji Fusión Extrema</title>
    <style>
        body {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            text-align: center;
            padding: 40px;
            min-height: 100vh;
            box-sizing: border-box;
        }
        h1 {
            font-size: 3em;
            margin-bottom: 20px;
            color: #ff6f91;
            text-shadow: 2px 2px rgba(0,0,0,0.1);
        }
        .inputs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        select {
            font-size: 1.5em;
            padding: 10px;
            border: 2px solid #ff6f91;
            border-radius: 10px;
            background: #fff;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: border 0.3s;
        }
        select:focus {
            border-color: #ff9671;
            outline: none;
        }
        button {
            background: #ff6f91;
            border: none;
            color: #fff;
            padding: 15px 25px;
            margin: 10px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 50px;
            transition: background 0.3s, transform 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        button:hover {
            background: #ff9671;
            transform: scale(1.05);
        }
        .fusion-modes {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .fusion-modes label {
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #fusionButton {
            background: #2ec4b6;
        }
        #fusionButton:hover {
            background: #20a09d;
        }
        #resultContainer {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 30px auto;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #fusionCanvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #ffffff;
        }
        .phrase {
            font-size: 1.5em;
            margin-top: 15px;
            min-height: 2em;
            color: #333;
            text-shadow: 1px 1px rgba(255,255,255,0.7);
        }
        .gallery {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        .gallery img {
            width: 80px;
            height: 80px;
            border: 3px solid #ff6f91;
            border-radius: 50%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: transform 0.3s, border-color 0.3s;
            cursor: pointer;
        }
        .gallery img:hover {
            transform: scale(1.2);
            border-color: #ff9671;
        }
    </style>
</head>
<body>
    <h1>Emoji Fusión Extrema</h1>
    <div class="inputs">
        <select id="emoji1">
            <option value="😀">😀</option>
            <option value="😂">😂</option>
            <option value="🤣">🤣</option>
            <option value="😊">😊</option>
            <option value="😍">😍</option>
            <option value="😒">😒</option>
            <option value="😘">😘</option>
            <option value="😎">😎</option>
            <option value="😭">😭</option>
            <option value="😡">😡</option>
            <option value="👍">👍</option>
            <option value="🙏">🙏</option>
            <option value="🔥">🔥</option>
            <option value="✨">✨</option>
            <option value="💖">💖</option>
            <option value="🎉">🎉</option>
            <option value="🌟">🌟</option>
            <option value="🍕">🍕</option>
            <option value="🍔">🍔</option>
            <option value="🍎">🍎</option>
            <option value="🚗">🚗</option>
            <option value="🏀">🏀</option>
            <option value="⚽">⚽</option>
            <option value="🎵">🎵</option>
            <option value="📚">📚</option>
            <option value="💡">💡</option>
            <option value="🌈">🌈</option>
            <option value="☀️">☀️</option>
            <option value="🌙">🌙</option>
            <option value="⭐">⭐</option>
            <option value="🌹">🌹</option>
            <option value="🍀">🍀</option>
            <option value="🍩">🍩</option>
            <option value="🎂">🎂</option>
            <option value="🎁">🎁</option>
            <option value="🎈">🎈</option>
            <option value="🦄">🦄</option>
            <option value="🐱">🐱</option>
            <option value="🐶">🐶</option>
            <option value="🐸">🐸</option>
            <option value="🐵">🐵</option>
            <option value="🦊">🦊</option>
            <option value="🐯">🐯</option>
            <option value="🐰">🐰</option>
            <option value="🐼">🐼</option>
            <option value="🐨">🐨</option>
            <option value="🦁">🦁</option>
            <option value="🐷">🐷</option>
            <option value="🐤">🐤</option>
        </select>
        <select id="emoji2">
            <option value="😀">😀</option>
            <option value="😂">😂</option>
            <option value="🤣">🤣</option>
            <option value="😊">😊</option>
            <option value="😍">😍</option>
            <option value="😒">😒</option>
            <option value="😘">😘</option>
            <option value="😎">😎</option>
            <option value="😭">😭</option>
            <option value="😡">😡</option>
            <option value="👍">👍</option>
            <option value="🙏">🙏</option>
            <option value="🔥">🔥</option>
            <option value="✨">✨</option>
            <option value="💖">💖</option>
            <option value="🎉">🎉</option>
            <option value="🌟">🌟</option>
            <option value="🍕">🍕</option>
            <option value="🍔">🍔</option>
            <option value="🍎">🍎</option>
            <option value="🚗">🚗</option>
            <option value="🏀">🏀</option>
            <option value="⚽">⚽</option>
            <option value="🎵">🎵</option>
            <option value="📚">📚</option>
            <option value="💡">💡</option>
            <option value="🌈">🌈</option>
            <option value="☀️">☀️</option>
            <option value="🌙">🌙</option>
            <option value="⭐">⭐</option>
            <option value="🌹">🌹</option>
            <option value="🍀">🍀</option>
            <option value="🍩">🍩</option>
            <option value="🎂">🎂</option>
            <option value="🎁">🎁</option>
            <option value="🎈">🎈</option>
            <option value="🦄">🦄</option>
            <option value="🐱">🐱</option>
            <option value="🐶">🐶</option>
            <option value="🐸">🐸</option>
            <option value="🐵">🐵</option>
            <option value="🦊">🦊</option>
            <option value="🐯">🐯</option>
            <option value="🐰">🐰</option>
            <option value="🐼">🐼</option>
            <option value="🐨">🐨</option>
            <option value="🦁">🦁</option>
            <option value="🐷">🐷</option>
            <option value="🐤">🐤</option>
        </select>
    </div>
    <button id="randomButton">Resultado Random</button>
    <div class="fusion-modes">
        <label><input type="radio" name="fusion" value="suave" checked> Mezcla Suave</label>
        <label><input type="radio" name="fusion" value="superposicion"> Superposición Loca</label>
        <label><input type="radio" name="fusion" value="artistico"> Abstracto Artístico</label>
    </div>
    <button id="fusionButton">Fusionar</button>
    <div id="resultContainer">
        <canvas id="fusionCanvas"></canvas>
    </div>
    <div class="phrase" id="phrase"></div>
    <button id="saveButton">Guardar</button>
    <button id="shareButton">Compartir</button>
    <div class="gallery" id="gallery"></div>
    <script>
        const emojis = [
            "😀","😂","🤣","😊","😍","😒","😘","😎","😭","😡","👍","🙏","🔥","✨","💖",
            "🎉","🌟","🍕","🍔","🍎","🚗","🏀","⚽","🎵","📚","💡","🌈","☀️","🌙",
            "⭐","🌹","🍀","🍩","🎂","🎁","🎈","🦄","🐱","🐶","🐸","🐵","🦊","🐯",
            "🐰","🐼","🐨","🦁","🐷","🐤"
        ];
        const phrases = [
            "¡Qué nivel, Maribel!",
            "Ja, me meo con el notas.",
            "Nos salen granos de verte",
            "Corramos un estúpido velo…",
            "Parece menterio…",
            "¿Qué me estás container?",
            "¿Dígamelón?",
            "En fin, serafín",
            "Qué risa, María Luisa",
            "¡Increíble fusión!",
            "Esto sí que es arte.",
            "¡Wow, impresionante!",
            "¡Genial combinación!",
            "¡Fantástico resultado!"
        ];

        const canvas = document.getElementById('fusionCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 300;
        canvas.height = 300;

        // Función para obtener la URL de la imagen del emoji
        function getEmojiURL(emoji) {
            const codePoints = [...emoji].map(c => c.codePointAt(0).toString(16)).join('-');
            return `https://twemoji.maxcdn.com/v/latest/72x72/${codePoints}.png`;
        }

        // Función para agregar la imagen a la galería
        function addToGallery() {
            const dataURL = canvas.toDataURL('image/png');
            const img = document.createElement('img');
            img.src = dataURL;
            document.getElementById('gallery').prepend(img);
        }

        // Función para generar un color aleatorio
        function getRandomColor(){
            const letters = '0123456789ABCDEF';
            let color = '#';
            for(let i=0;i<6;i++) color += letters[Math.floor(Math.random() * 16)];
            return color;
        }

        // Evento para seleccionar emojis aleatorios
        document.getElementById('randomButton').addEventListener('click', () => {
            const emoji1 = emojis[Math.floor(Math.random() * emojis.length)];
            const emoji2 = emojis[Math.floor(Math.random() * emojis.length)];
            document.getElementById('emoji1').value = emoji1;
            document.getElementById('emoji2').value = emoji2;
        });

        // Evento para fusionar emojis
        document.getElementById('fusionButton').addEventListener('click', async () => {
            const e1 = document.getElementById('emoji1').value || "😀";
            const e2 = document.getElementById('emoji2').value || "😀";
            const mode = document.querySelector('input[name="fusion"]:checked').value;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            document.getElementById('phrase').textContent = "";

            const phrase = phrases[Math.floor(Math.random() * phrases.length)];
            document.getElementById('phrase').textContent = phrase;

            try {
                const img1 = await loadImage(getEmojiURL(e1));
                const img2 = await loadImage(getEmojiURL(e2));

                if(mode === "suave"){
                    blendEmojis(img1, img2);
                }
                else if(mode === "superposicion"){
                    superposeEmojis(img1, img2);
                }
                else if(mode === "artistico"){
                    artisticFusion(img1, img2);
                }
            } catch (error) {
                console.error('Error al cargar las imágenes:', error);
                alert('Error al cargar las imágenes de los emojis. Por favor, intenta con otros emojis.');
            }
        });

        // Función para cargar una imagen con Promesas
        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.src = src;
                img.onload = () => {
                    console.log(`Imagen cargada: ${src}`);
                    resolve(img);
                };
                img.onerror = (err) => {
                    console.error(`Error al cargar la imagen: ${src}`);
                    reject(err);
                };
            });
        }

        // Función para Mezcla Suave
        function blendEmojis(img1, img2){
            let opacity = 0;
            const blendInterval = setInterval(() => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                // Fondo sólido
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                // Dibujar primer emoji
                ctx.globalAlpha = 1 - opacity;
                ctx.drawImage(img1, 0, 0, canvas.width, canvas.height);
                // Dibujar segundo emoji
                ctx.globalAlpha = opacity;
                ctx.drawImage(img2, 0, 0, canvas.width, canvas.height);
                opacity += 0.02;
                if(opacity >=1 ){
                    clearInterval(blendInterval);
                    // Fusion final sin transparencia
                    ctx.globalAlpha =1;
                    // Dibujar ambas imágenes sobre el fondo
                    ctx.drawImage(img1, 0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img2, 0, 0, canvas.width, canvas.height);
                    addToGallery();
                }
            }, 20);
        }

        // Función para Superposición Loca
        function superposeEmojis(img1, img2){
            // Fondo sólido
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            // Dibujar primer emoji con rotación aleatoria
            const angle1 = Math.random() * Math.PI * 2;
            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.rotate(angle1);
            ctx.drawImage(img1, -canvas.width / 2, -canvas.height / 2, canvas.width, canvas.height);
            ctx.restore();
            // Dibujar segundo emoji con rotación aleatoria y escala
            const angle2 = Math.random() * Math.PI * 2;
            const scale = 1 + Math.random() * 0.5; // Escala entre 1 y 1.5
            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.rotate(angle2);
            ctx.scale(scale, scale);
            ctx.drawImage(img2, -canvas.width / 2, -canvas.height / 2, canvas.width, canvas.height);
            ctx.restore();
            addToGallery();
        }

        // Función para Fusión Abstracto Artístico
        function artisticFusion(img1, img2){
            // Fondo colorido
            ctx.fillStyle = getRandomColor();
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            // Dibujar múltiples instancias de ambos emojis con transformaciones
            for(let i=0; i<20; i++){
                ctx.save();
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const angle = Math.random() * Math.PI * 2;
                const scale = 0.5 + Math.random() * 1.5;
                ctx.translate(x, y);
                ctx.rotate(angle);
                ctx.scale(scale, scale);
                ctx.globalAlpha = 0.5 + Math.random() * 0.5;
                const chosenImg = Math.random() > 0.5 ? img1 : img2;
                ctx.drawImage(chosenImg, -chosenImg.width / 4, -chosenImg.height / 4, chosenImg.width / 2, chosenImg.height / 2);
                ctx.restore();
            }
            // Fusion central sin transparencia
            ctx.globalAlpha = 1;
            ctx.drawImage(img1, 0, 0, canvas.width, canvas.height);
            ctx.drawImage(img2, 0, 0, canvas.width, canvas.height);
            addToGallery();
        }

        // Evento para guardar la imagen fusionada
        document.getElementById('saveButton').addEventListener('click', () => {
            const dataURL = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.href = dataURL;
            link.download = 'emoji_fusion.png';
            link.click();
        });

        // Evento para compartir la imagen fusionada
        document.getElementById('shareButton').addEventListener('click', () => {
            const dataURL = canvas.toDataURL('image/png');
            // Convertir dataURL a blob
            fetch(dataURL)
                .then(res => res.blob())
                .then(blob => {
                    const formData = new FormData();
                    formData.append('image', blob);
                    // Subir a imgbb.com (requiere API key)
                    fetch('https://api.imgbb.com/1/upload?key=YOUR_IMGBB_API_KEY', { // Reemplaza con tu API Key de ImgBB
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if(data.success){
                            const imageURL = data.data.url;
                            const shareText = encodeURIComponent("¡Mira mi nueva fusión de emojis!");
                            const shareURL = `https://twitter.com/intent/tweet?text=${shareText}&url=${encodeURIComponent(imageURL)}`;
                            window.open(shareURL, '_blank');
                        } else {
                            alert('Error al subir la imagen.');
                        }
                    })
                    .catch(() => alert('Error al subir la imagen.'));
                })
                .catch(() => alert('Error al convertir la imagen.'));
        });
    </script>
</body>
</html>