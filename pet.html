<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üêæ Neonpet Deluxe üêæ</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(45deg, #ff00ff, #00ffff);
            --secondary-gradient: linear-gradient(45deg, #ff8a00, #e52e71);
            --neon-blue: #00ffff;
            --neon-pink: #ff00ff;
            --neon-yellow: #ffff00;
            --neon-green: #39ff14;
            --background-color: #1a0b2e;
            --overlay-color: rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--background-color);
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            position: relative;
            overflow: hidden;
            min-height: 100vh;
        }

        /* Overlay para atenuar la pantalla al morir */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--overlay-color);
            display: none;
            z-index: 15;
            transition: opacity 0.5s ease;
        }

        /* Clase para mostrar la overlay */
        .overlay.active {
            display: block;
            opacity: 1;
        }

        /* Clase para aplicar desenfoque cuando la luz est√° apagada */
        .blurred .game-container {
            filter: blur(5px);
            transition: filter 0.5s ease;
        }

        .frame {
            border: 2px solid var(--neon-blue);
            border-radius: 20px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 0 10px var(--neon-blue);
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .currency, .xp, .level, .weather {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--neon-yellow);
            text-shadow: 0 0 5px var(--neon-yellow);
            margin: 5px 0;
        }

        .status-bars {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .status-bar {
            width: 30%;
            min-width: 80px;
            text-align: center;
        }

        .bar-container {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 5px;
        }

        .status-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        #hunger-fill { background: var(--primary-gradient); }
        #fun-fill { background: var(--secondary-gradient); }
        #hygiene-fill { background: linear-gradient(45deg, #4facfe, #00f2fe); }

        .status-emoji {
            font-size: 1.5em;
        }

        .display-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .display-left, .display-right {
            width: 48%;
            border: 2px solid var(--neon-blue);
            border-radius: 10px;
            padding: 5px;
            height: 70px;
            overflow-y: auto;
        }

        .display-right {
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        .event-icon {
            font-size: 0.9em;
            margin-bottom: 5px;
            color: var(--neon-yellow);
            text-shadow: 0 0 5px var(--neon-yellow);
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .pet-frame {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            margin-bottom: 10px;
        }

        /* Clase para simetr√≠a en la cuadr√≠cula */
        .mini-game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 5px;
            width: 200px;
            height: 200px;
            margin: 20px auto;
        }

        .mini-game-cell {
            width: 100%;
            height: 100%;
            background-color: var(--neon-blue);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .mini-game-cell:active {
            transform: scale(0.95);
        }

        .pet-container {
            position: absolute;
            width: 30vh;
            height: 30vh;
            transition: transform 0.5s ease;
        }

        .pet {
            font-size: 15vh;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            filter: drop-shadow(0 0 5px var(--neon-yellow));
            user-select: none;
            transition: all 0.5s ease;
            cursor: pointer;
            z-index: 10;
        }

        .pet-accessory {
            position: absolute;
            font-size: 10vh;
            z-index: 11;
            cursor: move;
            transition: all 0.5s ease;
        }

        .accessory-crown { top: -5vh; left: 50%; transform: translateX(-50%); }
        .accessory-glasses { top: 4vh; left: 50%; transform: translateX(-50%); font-size: 11vh; }
        .accessory-hat { top: -5.5vh; left: 50%; transform: translateX(-50%); }

        .action-buttons {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            position: sticky;
            bottom: 0;
            background-color: var(--background-color);
        }

        .action-btn {
            font-size: 2em;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--neon-blue);
            border-radius: 10px;
            padding: 10px;
            color: white;
            text-shadow: 0 0 5px var(--neon-blue);
            transition: transform 0.2s ease;
            margin: 5px;
            flex: 1 1 80px;
            max-width: 100px;
            text-align: center;
            cursor: pointer;
        }

        .action-btn:active {
            transform: scale(0.9);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 20;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background-color: rgba(0,0,0,0.8);
        }

        .modal-content {
            background: var(--background-color);
            margin: 10% auto;
            padding: 20px;
            border: 2px solid var(--neon-blue);
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
            border-radius: 20px;
            box-shadow: 0 0 15px var(--neon-blue);
            position: relative;
        }

        .close, .close-chest {
            color: var(--neon-pink);
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover, .close-chest:hover,
        .close:focus, .close-chest:focus {
            color: var(--neon-yellow);
            text-decoration: none;
        }

        .chest-modal {
            display: none;
            position: fixed;
            z-index: 20;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background-color: rgba(0,0,0,0.7);
        }

        .chest-content {
            background-color: var(--background-color);
            margin: 15% auto;
            padding: 20px;
            border: 2px solid var(--neon-blue);
            width: 80%;
            max-width: 300px;
            border-radius: 10px;
            position: relative;
        }

        .chest-item {
            display: inline-block;
            font-size: 1.5em;
            margin: 5px;
            cursor: pointer;
        }

        .shop-items, .food-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .shop-item, .food-item {
            font-size: 1.2em;
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .shop-item:active, .food-item:active {
            transform: scale(0.95);
        }

        .chest, .shop-icon {
            font-size: 2em;
            cursor: pointer;
            margin: 0 15px;
        }

        .light-switch {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 12;
        }

        .poop {
            position: absolute;
            font-size: 3em;
            cursor: pointer;
            z-index: 9;
        }

        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: opacity 1s ease;
            z-index: 5;
        }

        /* Nuevas clases para los fondos */
        .background1 {
            background: linear-gradient(to bottom, #87CEEB, #E0F6FF); /* Azul cielo a azul claro */
        }

        .background2 {
            background: linear-gradient(to bottom, #FF7F50, #FFB6C1); /* Coral a rosa claro */
        }

        .background3 {
            background: linear-gradient(to bottom, #191970, #000000); /* Azul medianoche a negro */
        }

        .grid-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            z-index: 1;
        }

        .grid-cell {
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-sizing: border-box;
        }

        /* Estilos para bonus de caricia */
        .caress-bonus {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            color: var(--neon-yellow);
            font-size: 1em;
            animation: fadeOut 3s forwards;
            z-index: 20;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }

        @media (max-width: 600px) {
            .currency, .xp, .weather {
                font-size: 1em;
            }
            .action-btn {
                font-size: 1.5em;
                padding: 8px;
                max-width: 80px;
            }
            .pet {
                font-size: 12vh;
            }
            .pet-container {
                width: 25vh;
                height: 25vh;
            }
            .event-icon {
                font-size: 0.8em;
            }
            .action-buttons {
                justify-content: center;
            }
            .action-btn {
                flex: 1 1 70px;
                margin: 5px;
            }
            .close, .close-chest {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Overlay para la muerte de la mascota -->
        <div class="overlay" id="deathOverlay"></div>

        <div class="frame info-bar">
            <div class="currency" id="currency">üí∞ 2000</div>
            <div class="xp" id="xp">‚≠ê 0</div>
            <div class="level" id="level">üî∫ Nivel 1</div>
            <div class="weather" id="weather">‚òÄÔ∏è</div>
        </div>
        <div class="frame status-bars">
            <div class="status-bar">
                <div class="bar-container"><div id="hunger-fill" class="status-fill"></div></div>
                <div class="status-emoji">üçî</div>
            </div>
            <div class="status-bar">
                <div class="bar-container"><div id="fun-fill" class="status-fill"></div></div>
                <div class="status-emoji">üéâ</div>
            </div>
            <div class="status-bar">
                <div class="bar-container"><div id="hygiene-fill" class="status-fill"></div></div>
                <div class="status-emoji">üöø</div>
            </div>
        </div>
        <div class="display-container">
            <div class="display-left" id="eventBar"></div>
            <div class="display-right">
                <div class="shop-icon" id="shopIcon">üè™</div>
                <div class="chest" id="chest">üì¶</div>
            </div>
        </div>
        <div class="frame pet-frame">
            <!-- Clase inicial para el fondo -->
            <div class="background background1" id="background"></div>
            <div class="grid-container" id="gridContainer"></div>
            <div class="pet-container">
                <div class="pet" id="pet" draggable="true">üòä</div>
                <div id="crown" class="pet-accessory accessory-crown" draggable="true"></div>
                <div id="glasses" class="pet-accessory accessory-glasses" draggable="true"></div>
                <div id="hat" class="pet-accessory accessory-hat" draggable="true"></div>
            </div>
            <div class="light-switch" id="lightSwitch">üí°</div>
        </div>
        <div class="action-buttons">
            <button class="action-btn" id="feed-btn">üçΩÔ∏è</button>
            <button class="action-btn" id="play-btn">üéÆ</button>
            <button class="action-btn" id="clean-btn">üßº</button>
        </div>

        <!-- Bonus por caricia -->
        <div class="caress-bonus" id="caressBonus" style="display: none;">
            üéâ ¬°Bonus por caricias activado! üéâ
        </div>
    </div>
    
    <!-- Modales -->
    <div id="shopModal" class="modal">
        <div class="modal-content">
            <span class="close">‚ùå</span>
            <h2>üõçÔ∏è Tienda</h2>
            <div class="shop-items" id="shop-items"></div>
        </div>
    </div>
    
    <div id="foodModal" class="modal">
        <div class="modal-content">
            <span class="close">‚ùå</span>
            <h2>üçΩÔ∏è Comida</h2>
            <div class="food-items" id="food-items"></div>
        </div>
    </div>
    
    <div id="miniGameModal" class="modal">
        <div class="modal-content">
            <span class="close">‚ùå</span>
            <h2>üéÆ Minijuego</h2>
            <div id="mini-game-board" class="mini-game-board"></div>
        </div>
    </div>
    
    <div id="chestModal" class="chest-modal">
        <div class="chest-content">
            <span class="close-chest" id="closeChest">‚ùå</span>
            <h2>üì¶ Cofre</h2>
            <div id="chestItems"></div>
        </div>
    </div>
    <script>
                
// Variables globales
let petState = {
  hunger: 100,
  fun: 100,
  hygiene: 100,
  currency: 2000,
  xp: 0,
  level: 1,
  isSick: false,
  isDead: false,
  isPaused: false,
  caressCount: 0,
  chestItems: [],
  shampooCount: 0,
  accessories: {
    crown: '',
    glasses: '',
    hat: ''
  },
  expression: 'üòä',
  currentBackground: 1,
  achievements: {},
  startTime: null,
  weatherTimer: 0,
  weatherInterval: 60, // Intervalo de cambio clim√°tico en segundos
  lastExpressionChangeTime: 0,
  expressionChangeInterval: 5000, // Cambiar expresi√≥n cada 5 segundos
  caressTimeout: null
};

// Elementos del DOM
let pet, petContainer, crown, glasses, hat, hungerFill, funFill, hygieneFill, currencyElement, xpElement, levelElement, weatherElement, eventBar, chest, lightSwitch, background, deathOverlay, caressBonus;

// Botones de acci√≥n
let feedBtn, playBtn, cleanBtn, shopIcon;

// Modales
let shopModal, foodModal, miniGameModal, chestModal, chestItemsContainer, closeChest;

// Constantes
const DECREASE_INTERVAL = 5000; // 5 segundos
const HUNGER_DECREASE_RATE = 1;
const FUN_DECREASE_RATE = 0.8;
const HYGIENE_DECREASE_RATE = 0.7;
const SICKNESS_PROBABILITY = 0.01;
const SPECIAL_EVENT_PROBABILITY = 0.01;

// Emojis para diferentes estados
const lowStateEmojis = ['üòü', 'üò¢', 'üò≠', 'üòû', 'üòî', 'üôÅ', 'üòï', 'üòñ'];
const mediumStateEmojis = ['üòê', 'üôÇ', 'üòå', 'üò∂', 'üòë', 'üòè', 'üòí', 'üòä'];
const highStateEmojis = ['üòÑ', 'üòç', 'üòÅ', 'üòÉ', 'üòÄ', 'üòä', 'ü•∞', 'üòé'];
const caressEmojis = ['üòª', 'üòΩ', 'üòò', 'ü•∞', 'ü§ó'];
const weatherEmojis = ['‚òÄÔ∏è', 'üåßÔ∏è', '‚ùÑÔ∏è', 'üå§Ô∏è', 'üåà'];
let currentWeatherIndex = 0;

// Items
const shopItems = [
  { emoji: 'üëë', price: 500, type: 'crown', requiredLevel: 5 },
  { emoji: 'üëì', price: 300, type: 'glasses', requiredLevel: 3 },
  { emoji: 'üß¢', price: 200, type: 'hat', requiredLevel: 2 },
  { emoji: 'üé©', price: 1000, type: 'topHat', requiredLevel: 10 },
  { emoji: 'üß¥', price: 50, type: 'shampoo', requiredLevel: 1 },
  { emoji: 'üíä', price: 100, type: 'medicine', requiredLevel: 1 },
  { emoji: 'ü•Ω', price: 800, type: 'goggles', requiredLevel: 8 },
  { emoji: 'üéì', price: 600, type: 'graduationCap', requiredLevel: 7 }
];

const foodItems = [
  { emoji: 'üçé', hunger: 10, price: 50, requiredLevel: 1 },
  { emoji: 'üçî', hunger: 25, price: 100, requiredLevel: 2 },
  { emoji: 'üçï', hunger: 20, price: 150, requiredLevel: 3 },
  { emoji: 'üç¶', hunger: 5, price: 80, requiredLevel: 1 },
  { emoji: 'ü•ó', hunger: 15, price: 120, requiredLevel: 2 },
  { emoji: 'üç±', hunger: 30, price: 200, requiredLevel: 4 },
  { emoji: 'üçâ', hunger: 12, price: 70, requiredLevel: 1 },
  { emoji: 'üçó', hunger: 28, price: 180, requiredLevel: 3 },
  { emoji: 'üç£', hunger: 22, price: 160, requiredLevel: 5 },
  { emoji: 'ü•©', hunger: 35, price: 250, requiredLevel: 6 },
  { emoji: 'üç∞', hunger: 18, price: 140, requiredLevel: 4 }
];

// Frases variadas para la interfaz
const phrases = {
  feed: [
    "¬°Qu√© rico! üòã",
    "¬°Gracias por la comida! üçΩÔ∏è",
    "¬°Estaba delicioso! ü§§",
    "¬°Justo lo que necesitaba! üç¥",
    "¬°Mmm, mi favorito! üòç",
    "¬°Cakiwaki est√° satisfecho! ü•∞",
    "¬°Energ√≠a renovada! üí™",
    "¬°Cakiwaki dice gracias! üôè",
    "¬°Esto sabe a felicidad! üòä",
    "¬°Comida de campeones! üèÜ"
  ],
  clean: [
    "¬°Gracias por mantenerme limpio! üõÅ",
    "¬°Me siento fresco! üå∏",
    "¬°A brillar! ‚ú®",
    "¬°Ahora huelo genial! üå∫",
    "¬°Listo para jugar! üèÉ‚Äç‚ôÇÔ∏è",
    "¬°Cakiwaki est√° reluciente! üíé",
    "¬°Nada como una buena limpieza! üßΩ",
    "¬°Me encanta estar limpio! üòä",
    "¬°Fuera suciedad! üßº",
    "¬°Gracias por cuidarme! ‚ù§Ô∏è"
  ],
  overfed: [
    "¬°Uf, com√≠ demasiado! ü§¢",
    "¬°Me siento pesado! üò£",
    "Creo que fue mucho... üòì",
    "¬°Ay, mi pancita! ü•¥",
    "Necesito descansar... üò¥"
  ],
  sick: [
    "No me siento bien... ü§í",
    "Creo que estoy enfermo... üò∑",
    "Necesito medicina... ü§ß",
    "¬°Achoo! ü§ß",
    "¬øPuedes ayudarme? üò¢"
  ],
  dead: [
    "Cakiwaki ha partido... üíÄ",
    "Adi√≥s, amigo... ü•Ä",
    "Fue un buen tiempo juntos... üò¢",
    "Cakiwaki ya no est√°... üïØÔ∏è",
    "Descansa en paz... üåô"
  ],
  levelUp: [
    "¬°Sub√≠ de nivel! üéâ",
    "¬°Soy m√°s fuerte ahora! üí™",
    "¬°Nivel nuevo, aventuras nuevas! üåü",
    "¬°Seguimos creciendo! üå±",
    "¬°Gracias por ayudarme! üòä"
  ]
};

// Funci√≥n para obtener una frase aleatoria
function getRandomPhrase(category) {
  return phrases[category][Math.floor(Math.random() * phrases[category].length)];
}

// Funci√≥n para obtener una expresi√≥n aleatoria
function getRandomExpression(emojisArray) {
  return emojisArray[Math.floor(Math.random() * emojisArray.length)];
}

// Funci√≥n para desactivar la selecci√≥n de texto
function disableTextSelection(element) {
  if (element) {
    element.style.userSelect = 'none';
    element.style.webkitUserSelect = 'none';
    element.style.msUserSelect = 'none';
    element.style.touchAction = 'manipulation';
  }
}

// Funci√≥n para inicializar el juego
function initializeGame() {
  pet = document.getElementById('pet');
  petContainer = document.querySelector('.pet-container');
  crown = document.getElementById('crown');
  glasses = document.getElementById('glasses');
  hat = document.getElementById('hat');
  hungerFill = document.getElementById('hunger-fill');
  funFill = document.getElementById('fun-fill');
  hygieneFill = document.getElementById('hygiene-fill');
  currencyElement = document.getElementById('currency');
  xpElement = document.getElementById('xp');
  levelElement = document.getElementById('level');
  weatherElement = document.getElementById('weather');
  eventBar = document.getElementById('eventBar');
  chest = document.getElementById('chest');
  lightSwitch = document.getElementById('lightSwitch');
  background = document.getElementById('background');
  deathOverlay = document.getElementById('deathOverlay');
  caressBonus = document.getElementById('caressBonus');

  feedBtn = document.getElementById('feed-btn');
  playBtn = document.getElementById('play-btn');
  cleanBtn = document.getElementById('clean-btn');
  shopIcon = document.getElementById('shopIcon');

  shopModal = document.getElementById('shopModal');
  foodModal = document.getElementById('foodModal');
  miniGameModal = document.getElementById('miniGameModal');
  chestModal = document.getElementById('chestModal');
  chestItemsContainer = document.getElementById('chestItems');
  closeChest = document.getElementById('closeChest');

  // Agregar eventos a los botones de acci√≥n
  if (feedBtn) feedBtn.addEventListener('click', () => openModal(foodModal, updateFoodMenu));
  if (playBtn) playBtn.addEventListener('click', () => openModal(miniGameModal, startRandomMiniGame));
  if (cleanBtn) cleanBtn.addEventListener('click', cleanPet);
  if (shopIcon) shopIcon.addEventListener('click', () => openModal(shopModal, updateShopItems));

  // Eventos para abrir y cerrar el cofre
  if (chest) chest.addEventListener('click', () => openModal(chestModal, updateChestItems));

  // Agregar eventos a todos los botones de cierre de modales
  const closeButtons = document.querySelectorAll('.close, .close-chest');
  closeButtons.forEach(button => {
    button.addEventListener('click', () => {
      const modal = button.closest('.modal, .chest-modal');
      if (modal) modal.style.display = 'none';
    });
  });

  // Cerrar modales al hacer clic fuera del contenido
  const modals = document.querySelectorAll('.modal, .chest-modal');
  modals.forEach(modal => {
    modal.addEventListener('click', (event) => {
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });
  });

  // Evento para el interruptor de luz (bot√≥n de pausa)
  if (lightSwitch) {
    lightSwitch.addEventListener('click', togglePause);
  }

  // Evento para acariciar a la mascota
  if (pet) {
    pet.addEventListener('click', (e) => {
      e.stopPropagation();
      handleCaressBonus();
    });
  }

  // Desactivar selecci√≥n de texto espec√≠ficamente en el emoji de la mascota y accesorios
  disableTextSelection(pet);
  disableTextSelection(crown);
  disableTextSelection(glasses);
  disableTextSelection(hat);

  // Cargar el juego y comenzar el ciclo de juego
  loadGame();

  // Ejecutar el gameLoop cada segundo
  setInterval(gameLoop, 1000);

  // Iniciar la oscilaci√≥n del emoji
  startPetOscillation();

  // Redimensionar la mascota al cargar
  resizePet();
  window.addEventListener('resize', resizePet);

  // Actualizar la rejilla del fondo
  updateGrid();
}

// Funci√≥n para cargar el juego desde localStorage
function loadGame() {
  const savedState = localStorage.getItem('petState');
  if (savedState) {
    Object.assign(petState, JSON.parse(savedState));
    updateAccessoryDisplay('crown', petState.accessories.crown);
    updateAccessoryDisplay('glasses', petState.accessories.glasses);
    updateAccessoryDisplay('hat', petState.accessories.hat);
    updateStatus();
    updateExpression();
  }
}

// Funci√≥n para guardar el estado del juego en localStorage
function saveGame() {
  localStorage.setItem('petState', JSON.stringify(petState));
}

// Funci√≥n principal para el ciclo del juego
function gameLoop() {
  if (petState.isPaused || petState.isDead) {
    updateExpression();
    return;
  }

  // Disminuir gradualmente los niveles
  decreaseStats();

  // Cambiar el clima si es el momento adecuado
  changeWeather();

  // Redimensionar los accesorios si es necesario
  resizeAccessories();

  // Actualizar la expresi√≥n de la mascota
  updateExpression();

  // Actualizar el estado visual del juego
  updateStatus();

  // Guardar el estado del juego
  saveGame();
}

// Funci√≥n para disminuir gradualmente los niveles de la mascota
function decreaseStats() {
  if (petState.isDead || petState.isPaused) return;

  // Disminuir los niveles, asegurando que no caigan por debajo de 0
  petState.hunger = Math.max(0, petState.hunger - (petState.hunger >= 90 ? HUNGER_DECREASE_RATE * 0.5 : HUNGER_DECREASE_RATE));
  petState.fun = Math.max(0, petState.fun - FUN_DECREASE_RATE);
  petState.hygiene = Math.max(0, petState.hygiene - HYGIENE_DECREASE_RATE);

  // Si el hambre llega a 0, la mascota muere
  if (petState.hunger <= 0) {
    petDeath();
  }

  // Si el hambre llega a 100, la mascota se empacha
  if (petState.hunger >= 100) {
    petState.isSick = true;
    changeExpression('ü§¢');
    addEventToBar(getRandomPhrase('overfed'), "Cakiwaki est√° empachado. Espera a que su hambre baje.");
  }

  // Si el hambre baja de 90 y estaba empachado, la mascota se recupera
  if (petState.hunger < 90 && petState.isSick && petState.expression === 'ü§¢') {
    petState.isSick = false;
    updateExpression();
    addEventToBar("üòä Cakiwaki se siente mejor", "El empacho ha pasado.");
  }

  // Posibilidad de que la mascota se enferme aleatoriamente
  randomSickness();

  // Actualizar el estado visual del juego
  updateStatus();
}

// Funci√≥n para manejar la enfermedad aleatoria
function randomSickness() {
  if (!petState.isSick && Math.random() < SICKNESS_PROBABILITY) {
    petState.isSick = true;
    changeExpression('ü§í');
    addEventToBar(getRandomPhrase('sick'), "Cakiwaki necesita medicina para recuperarse.");
  }
}

// Funci√≥n para manejar la muerte de la mascota
function petDeath() {
  petState.isDead = true;
  changeExpression('üíÄ');
  addEventToBar(getRandomPhrase('dead'), "Alimenta a Cakiwaki para revivirlo.");
  deathOverlay.style.display = 'block';
  saveGame();
}

// Funci√≥n para cambiar la expresi√≥n de la mascota
function changeExpression(newExpression) {
  if (pet) {
    pet.textContent = newExpression;
    petState.expression = newExpression;
    saveGame();
  }
}

// Funci√≥n para actualizar la expresi√≥n de la mascota
function updateExpression() {
  if (petState.isDead) {
    changeExpression('üíÄ');
  } else if (petState.isPaused) {
    changeExpression('üò¥');
  } else if (petState.isSick) {
    changeExpression(petState.hunger >= 100 ? 'ü§¢' : 'ü§í');
  } else if (petState.caressing) {
    changeExpression(getRandomExpression(caressEmojis));
  } else {
    const now = Date.now();
    if (now - petState.lastExpressionChangeTime > petState.expressionChangeInterval) {
      if (petState.hunger <= 20 || petState.fun <= 20 || petState.hygiene <= 20) {
        changeExpression(getRandomExpression(lowStateEmojis));
      } else if (petState.hunger >= 80 && petState.fun >= 80 && petState.hygiene >= 80) {
        changeExpression(getRandomExpression(highStateEmojis));
      } else {
        changeExpression(getRandomExpression(mediumStateEmojis));
      }
      petState.lastExpressionChangeTime = now;
    }
  }
}

// Funci√≥n para manejar el bonus por caricias
function handleCaressBonus() {
  if (petState.isDead) return;

  petState.caressCount = (petState.caressCount || 0) + 1;
  petState.caressing = true;
  changeExpression(getRandomExpression(caressEmojis));

  if (petState.caressCount % 5 === 0) {
    const funBonus = 10;
    petState.fun = Math.min(100, petState.fun + funBonus);
    addEventToBar(`üíñ ¬°Bonus por caricias! +${funBonus}% diversi√≥n`, "Cakiwaki aprecia tus caricias.");
    showCaressBonusNotification();
  }

  clearTimeout(petState.caressTimeout);
  petState.caressTimeout = setTimeout(() => {
    petState.caressing = false;
    updateExpression();
  }, 1000);

  updateStatus();
  saveGame();
}

// Funci√≥n para mostrar la notificaci√≥n de bonus por caricias
function showCaressBonusNotification() {
  caressBonus.style.display = 'block';
  setTimeout(() => {
    caressBonus.style.display = 'none';
  }, 3000);
}

// Funci√≥n para limpiar a la mascota
function cleanPet() {
  if (petState.shampooCount > 0) {
    petState.hygiene = Math.min(100, petState.hygiene + 40);
    petState.shampooCount--;
    petState.currency += 10;
    addEventToBar(getRandomPhrase('clean'), "Mantener a Cakiwaki limpio lo hace m√°s feliz y saludable. ¬°Buen trabajo!");

    const poops = document.querySelectorAll('.poop');
    poops.forEach(poop => poop.remove());

    gainXP(5);
    updateStatus();
    saveGame();
  } else {
    addEventToBar("‚ùå No tienes shampoo", "Puedes comprar m√°s shampoo en la tienda. ¬°Mantener la higiene es importante!");
  }
}

// Funci√≥n para mostrar eventos en el event bar
function addEventToBar(message, additionalInfo = "") {
  const eventIcon = document.createElement('div');
  eventIcon.classList.add('event-icon');
  eventIcon.innerHTML = `${message}<br><small>${additionalInfo}</small>`;
  eventIcon.style.fontSize = '0.8em';
  eventBar.insertBefore(eventIcon, eventBar.firstChild);

  while (eventBar.childNodes.length > 5) {
    eventBar.removeChild(eventBar.lastChild);
  }
}

// Funci√≥n para actualizar el estado visual del juego
function updateStatus() {
  if (hungerFill) hungerFill.style.width = `${petState.hunger}%`;
  if (funFill) funFill.style.width = `${petState.fun}%`;
  if (hygieneFill) hygieneFill.style.width = `${petState.hygiene}%`;
  if (currencyElement) currencyElement.textContent = `üí∞ ${petState.currency}`;
  if (xpElement) xpElement.textContent = `‚≠ê ${petState.xp} / ${petState.level * 100}`;
  if (levelElement) levelElement.textContent = `üî∫ Nivel ${petState.level}`;

  applyVisualEffects();
}

// Funci√≥n para aplicar efectos visuales basados en el estado de la mascota
function applyVisualEffects() {
  if (petState.isDead) {
    pet.style.filter = 'grayscale(100%)';
  } else if (petState.isSick) {
    pet.style.filter = 'hue-rotate(180deg)';
  } else {
    pet.style.filter = 'none';
  }

  // Efecto de brillo basado en la diversi√≥n
  const brightness = 100 + (petState.fun / 2);
  pet.style.filter += ` brightness(${brightness}%)`;

  // Cambiar el tama√±o de la mascota seg√∫n sus niveles
  resizePet();
}

// Funci√≥n para redimensionar la mascota y los accesorios
function resizePet() {
  const petFrame = document.querySelector('.pet-frame');
  const frameSize = Math.min(petFrame.offsetWidth, petFrame.offsetHeight);

  // Calcular el tama√±o de la mascota basado en los niveles
  const averageLevel = (petState.hunger + petState.fun + petState.hygiene) / 3;
  const petSizeFactor = 0.4 + (averageLevel / 250); // Factor entre 0.4 y 0.8
  const petSize = frameSize * petSizeFactor; // La mascota ocupa entre el 40% y 80% del frame

  pet.style.fontSize = `${petSize}px`;
  resizeAccessories();
}

// Funci√≥n para redimensionar los accesorios
function resizeAccessories() {
  const petSize = pet.getBoundingClientRect();
  const scaleFactor = petSize.width / 100; // Escalar proporcionalmente al tama√±o del emoji

  if (crown) crown.style.transform = `translate(-50%, -50%) scale(${scaleFactor})`;
  if (glasses) glasses.style.transform = `translate(-50%, -50%) scale(${scaleFactor})`;
  if (hat) hat.style.transform = `translate(-50%, -50%) scale(${scaleFactor})`;
}

// Funci√≥n para cambiar el clima con intervalos m√°s largos
function changeWeather() {
  if (petState.isDead || petState.isPaused) return;

  petState.weatherTimer++;
  if (petState.weatherTimer >= petState.weatherInterval) {
    currentWeatherIndex = (currentWeatherIndex + 1) % weatherEmojis.length;
    weatherElement.textContent = weatherEmojis[currentWeatherIndex];
    applyWeatherEffects();
    petState.weatherTimer = 0;
  }
}

// Funci√≥n para aplicar efectos del clima
function applyWeatherEffects() {
  const currentWeather = weatherEmojis[currentWeatherIndex];
  switch (currentWeather) {
    case '‚òÄÔ∏è':
      background.className = 'background background1';
      break;
    case 'üåßÔ∏è':
      background.className = 'background background2';
      break;
    case '‚ùÑÔ∏è':
      background.className = 'background background3';
      break;
    case 'üå§Ô∏è':
      background.className = 'background background1';
      break;
    case 'üåà':
      background.className = 'background background2';
      break;
    default:
      background.className = 'background background1';
      break;
  }
}

// Funci√≥n para limpiar a la mascota
function cleanPet() {
  if (petState.shampooCount > 0) {
    petState.hygiene = Math.min(100, petState.hygiene + 40);
    petState.shampooCount--;
    petState.currency += 10;
    addEventToBar(getRandomPhrase('clean'), "Mantener a Cakiwaki limpio lo hace m√°s feliz y saludable. ¬°Buen trabajo!");

    const poops = document.querySelectorAll('.poop');
    poops.forEach(poop => poop.remove());

    gainXP(5);
    updateStatus();
    saveGame();
  } else {
    addEventToBar("‚ùå No tienes shampoo", "Puedes comprar m√°s shampoo en la tienda. ¬°Mantener la higiene es importante!");
  }
}

// Funci√≥n para mostrar eventos en el event bar
function addEventToBar(message, additionalInfo = "") {
  const eventIcon = document.createElement('div');
  eventIcon.classList.add('event-icon');
  eventIcon.innerHTML = `${message}<br><small>${additionalInfo}</small>`;
  eventIcon.style.fontSize = '0.8em';
  eventBar.insertBefore(eventIcon, eventBar.firstChild);

  while (eventBar.childNodes.length > 5) {
    eventBar.removeChild(eventBar.lastChild);
  }
}

// Funci√≥n para manejar la pausa cuando se presiona el bot√≥n de bombillo
function togglePause() {
  petState.isPaused = !petState.isPaused;
  if (petState.isPaused) {
    addEventToBar("üí§ Cakiwaki est√° durmiendo", "Los niveles se detienen.");
    changeExpression('üò¥');
  } else {
    addEventToBar("‚èØÔ∏è Cakiwaki ha despertado", "Las necesidades se reanudan.");
    updateExpression();
  }
  saveGame();
}

// Funci√≥n para abrir un modal y actualizar su contenido
function openModal(modal, updateFunction) {
  modal.style.display = 'block';
  updateFunction();
}

// Funci√≥n para actualizar los items de la tienda
function updateShopItems() {
  const shopItemsContainer = document.getElementById('shop-items');
  if (shopItemsContainer) {
    shopItemsContainer.innerHTML = '';
    shopItems.forEach(item => {
      const itemElement = createShopItem(item);
      shopItemsContainer.appendChild(itemElement);
    });
  }
}

// Funci√≥n para crear un item de la tienda
function createShopItem(item) {
  const itemElement = document.createElement('div');
  itemElement.classList.add('shop-item');
  itemElement.innerHTML = `${item.emoji}<br>üí∞${item.price}<br>Nivel ${item.requiredLevel}`;

  if (['crown', 'glasses', 'hat', 'goggles', 'topHat', 'graduationCap'].includes(item.type)) {
    itemElement.onclick = () => toggleAccessoryButtons(item, itemElement);
  } else {
    itemElement.onclick = () => buyConsumableItem(item);
  }

  if (petState.level < item.requiredLevel || petState.currency < item.price) {
    itemElement.style.opacity = '0.5';
    itemElement.style.cursor = 'not-allowed';
  }

  return itemElement;
}

// Funci√≥n para actualizar el men√∫ de comida
function updateFoodMenu() {
  const foodItemsContainer = document.getElementById('food-items');
  foodItemsContainer.innerHTML = '';
  foodItems.forEach(item => {
    const itemElement = document.createElement('div');
    itemElement.classList.add('food-item');
    itemElement.innerHTML = `${item.emoji}<br>üí∞${item.price}<br>Nivel ${item.requiredLevel}`;
    itemElement.onclick = () => feedPet(item);

    if (petState.level < item.requiredLevel || petState.currency < item.price) {
      itemElement.style.opacity = '0.5';
      itemElement.style.cursor = 'not-allowed';
    }

    foodItemsContainer.appendChild(itemElement);
  });
}

// Funci√≥n para alternar los botones de accesorios
function toggleAccessoryButtons(item, itemElement) {
  if (itemElement.querySelector('.accessory-buttons')) return;

  const buttonsContainer = document.createElement('div');
  buttonsContainer.classList.add('accessory-buttons');

  const tickButton = document.createElement('button');
  tickButton.textContent = '‚úîÔ∏è';
  tickButton.classList.add('tick-button');
  tickButton.style.marginRight = '5px';
  tickButton.addEventListener('click', (e) => {
    e.stopPropagation();
    equipAccessory(item, itemElement);
  });

  const crossButton = document.createElement('button');
  crossButton.textContent = '‚ùå';
  crossButton.classList.add('cross-button');
  crossButton.addEventListener('click', (e) => {
    e.stopPropagation();
    unequipAccessory(item, itemElement);
  });

  buttonsContainer.appendChild(tickButton);
  buttonsContainer.appendChild(crossButton);
  itemElement.appendChild(buttonsContainer);
}

// Funci√≥n para equipar un accesorio
function equipAccessory(item, itemElement) {
  if (petState.currency < item.price || petState.level < item.requiredLevel) {
    addEventToBar("‚ùå No tienes suficientes recursos para equipar este accesorio.", "Aseg√∫rate de tener el nivel y monedas necesarios.");
    removeAccessoryButtons(itemElement);
    return;
  }

  petState.currency -= item.price;
  petState.accessories[getAccessoryType(item.type)] = item.emoji;
  updateAccessoryDisplay(getAccessoryType(item.type), item.emoji);
  addEventToBar(`üõçÔ∏è Compraste y equipaste: ${item.emoji}`, "¬°Cakiwaki luce genial con su nuevo accesorio!");
  gainXP(10);
  saveGame();
  removeAccessoryButtons(itemElement);
  shopModal.style.display = 'none';
}

// Funci√≥n para desequipar un accesorio
function unequipAccessory(item, itemElement) {
  if (petState.accessories[getAccessoryType(item.type)] === item.emoji) {
    petState.accessories[getAccessoryType(item.type)] = '';
    updateAccessoryDisplay(getAccessoryType(item.type), '');
    addEventToBar(`‚ùå Has quitado: ${item.emoji}`, "El accesorio ha sido removido de Cakiwaki.");
    gainXP(5);
    saveGame();
  }
  removeAccessoryButtons(itemElement);
}

// Funci√≥n para actualizar la visualizaci√≥n de accesorios
function updateAccessoryDisplay(type, emoji) {
  const accessoryElement = document.getElementById(type);
  if (accessoryElement) {
    accessoryElement.textContent = emoji;
  }
}

// Funci√≥n para comprar un item consumible
function buyConsumableItem(item) {
  if (petState.currency >= item.price && petState.level >= item.requiredLevel) {
    petState.currency -= item.price;
    switch(item.type) {
      case 'shampoo':
        petState.shampooCount++;
        addEventToBar(`üß¥ Has comprado shampoo`, "Mantener limpio a Cakiwaki ser√° m√°s f√°cil ahora.");
        break;
      case 'medicine':
        handleMedicinePurchase();
        break;
    }
    gainXP(10);
    saveGame();
    shopModal.style.display = 'none';
  } else if (petState.level < item.requiredLevel) {
    addEventToBar(`‚ùå Necesitas nivel ${item.requiredLevel} para comprar esto.`, "Sigue cuidando a Cakiwaki para subir de nivel y desbloquear nuevos art√≠culos.");
  } else {
    addEventToBar("‚ùå No tienes suficientes monedas.", "Juega minijuegos o completa logros para ganar m√°s monedas.");
  }
}

// Funci√≥n para manejar la compra de medicina
function handleMedicinePurchase() {
  if (petState.isSick && petState.expression !== 'ü§¢') {
    petState.isSick = false;
    updateExpression();
    addEventToBar("üíä Cakiwaki se ha curado", "¬°Bien hecho! Cakiwaki se siente mucho mejor gracias a ti.");
  } else {
    addEventToBar("üíä Guardaste la medicina para m√°s tarde", "Es bueno estar preparado. Podr√°s usar la medicina cuando Cakiwaki se enferme.");
    petState.chestItems.push('üíä');
  }
  gainXP(5);
  saveGame();
}

// Funci√≥n para obtener el tipo de accesorio
function getAccessoryType(type) {
  switch (type) {
    case 'crown':
    case 'topHat':
    case 'graduationCap':
      return 'crown';
    case 'glasses':
    case 'goggles':
      return 'glasses';
    case 'hat':
      return 'hat';
    default:
      return type;
  }
}

// Funci√≥n para remover los botones de accesorios
function removeAccessoryButtons(itemElement) {
  const buttonsContainer = itemElement.querySelector('.accessory-buttons');
  if (buttonsContainer) {
    buttonsContainer.remove();
  }
}

// Funci√≥n para alimentar a la mascota
function feedPet(food) {
  if (petState.isDead) {
    revivePet();
    return;
  }

  if (petState.currency >= food.price && petState.level >= food.requiredLevel) {
    petState.currency -= food.price;
    petState.hunger = Math.min(100, petState.hunger + food.hunger);
    addEventToBar(getRandomPhrase('feed'), `${food.emoji} ¬°Delicioso! Cakiwaki ha disfrutado su comida.`);
    gainXP(5);
    saveGame();
    foodModal.style.display = 'none'; // Cerrar el men√∫ de comida
  } else if (petState.level < food.requiredLevel) {
    addEventToBar(`‚ùå Necesitas nivel ${food.requiredLevel} para comprar esto.`, "Sigue cuidando a Cakiwaki para subir de nivel y desbloquear nuevas comidas.");
  } else {
    addEventToBar("‚ùå No tienes suficientes monedas.", "Juega minijuegos o completa logros para ganar m√°s monedas.");
  }
}

// Funci√≥n para revivir a la mascota
function revivePet() {
  petState.isDead = false;
  petState.hunger = 50;
  petState.fun = 50;
  petState.hygiene = 50;
  changeExpression('üòä');
  addEventToBar("üéâ ¬°Cakiwaki ha revivido!", "Gracias por no abandonar a tu amigo. Cu√≠dalo bien esta vez.");
  deathOverlay.style.display = 'none';
  saveGame();
}

// Funci√≥n para iniciar un minijuego aleatorio
function startRandomMiniGame() {
  memoryGame();
}

// Implementaci√≥n del minijuego 'Busca a tu pareja' (Memory Game)
function memoryGame() {
  const miniGameBoard = document.getElementById('mini-game-board');
  miniGameBoard.innerHTML = '';
  miniGameModal.style.display = 'block';

  const emojis = ['üçé', 'üçå', 'üçí', 'üçá', 'üçâ', 'üçì', 'ü•ù', 'üçç'];
  const gameEmojis = [...emojis, ...emojis]; // Duplicar para hacer pares
  gameEmojis.sort(() => 0.5 - Math.random()); // Mezclar los emojis

  let firstCard = null;
  let secondCard = null;
  let lockBoard = false;
  let matchesFound = 0;

  gameEmojis.forEach((emoji, index) => {
    const card = document.createElement('div');
    card.classList.add('mini-game-cell');
    card.dataset.emoji = emoji;
    card.dataset.index = index;
    card.textContent = '‚ùì';

    card.addEventListener('click', () => {
      if (lockBoard || card === firstCard || card.classList.contains('matched')) return;

      card.textContent = emoji;

      if (!firstCard) {
        firstCard = card;
      } else {
        secondCard = card;
        lockBoard = true;

        if (firstCard.dataset.emoji === secondCard.dataset.emoji) {
          firstCard.classList.add('matched');
          secondCard.classList.add('matched');
          matchesFound++;
          resetCards();

          if (matchesFound === emojis.length) {
            addEventToBar("üéâ ¬°Ganaste el minijuego!", "+20% diversi√≥n y +50 monedas");
            petState.fun = Math.min(100, petState.fun + 20);
            petState.currency += 50;
            gainXP(20);
            miniGameModal.style.display = 'none';
            saveGame();
          }
        } else {
          setTimeout(() => {
            firstCard.textContent = '‚ùì';
            secondCard.textContent = '‚ùì';
            resetCards();
          }, 1000);
        }
      }
    });

    miniGameBoard.appendChild(card);
  });

  function resetCards() {
    [firstCard, secondCard] = [null, null];
    lockBoard = false;
  }
}

// Funci√≥n para ganar XP y subir de nivel
function gainXP(amount) {
  petState.xp += amount;
  if (petState.xp >= petState.level * 100) {
    levelUp();
  } else {
    addEventToBar(`‚≠ê +${amount} XP`, "¬°Sigue as√≠! Cada punto de experiencia te acerca al siguiente nivel.");
  }
  updateStatus();
}

// Funci√≥n para subir de nivel
function levelUp() {
  petState.level++;
  petState.xp = 0;
  addEventToBar(getRandomPhrase('levelUp'), "¬°Incre√≠ble progreso! Cada nivel desbloquea nuevas posibilidades para Cakiwaki.");
  petState.currency += petState.level * 50;
  updateStatus();
}

// Funci√≥n para iniciar la oscilaci√≥n de la mascota
function startPetOscillation() {
  let angle = 0;
  const baseAmplitude = 10;
  let amplitude = baseAmplitude;

  function oscillate() {
    if (!petState.isPaused && !petState.isDead) {
      if (petState.hunger > 80 && petState.fun > 80 && petState.hygiene > 80) {
        amplitude = 20;
        angle += 0.2;
      } else {
        amplitude = baseAmplitude;
        angle += 0.1;
      }

      const offsetX = amplitude * Math.sin(angle);
      pet.style.transform = `translate(-50%, -50%) translateX(${offsetX}px)`;
    }
    requestAnimationFrame(oscillate);
  }
  oscillate();
}

// Funci√≥n para manejar eventos especiales
function handleSpecialEvents() {
  if (Math.random() < SPECIAL_EVENT_PROBABILITY && !petState.isDead && !petState.isPaused) {
    const events = [
      { name: "Lluvia de monedas", action: () => {
        const coinsGained = Math.floor(Math.random() * 50) + 10;
        petState.currency += coinsGained;
        addEventToBar(`üåßÔ∏èüí∞ ¬°Lluvia de monedas! +${coinsGained} monedas`, "¬°Una sorpresa agradable para Cakiwaki!");
      }},
      { name: "Arco√≠ris de felicidad", action: () => {
        petState.fun = 100;
        addEventToBar("üåà ¬°Arco√≠ris de felicidad!", "Cakiwaki est√° extremadamente feliz ahora.");
      }},
      { name: "Ducha refrescante", action: () => {
        petState.hygiene = 100;
        addEventToBar("üöø ¬°Ducha refrescante!", "Cakiwaki est√° completamente limpio.");
      }},
      { name: "Fiesta sorpresa", action: () => {
        gainXP(50);
        addEventToBar("üéâ ¬°Fiesta sorpresa!", "Cakiwaki gan√≥ 50 XP por esta celebraci√≥n inesperada.");
      }}
    ];

    const randomEvent = events[Math.floor(Math.random() * events.length)];
    randomEvent.action();
    updateStatus();
    saveGame();
  }
}

// Funci√≥n para actualizar la rejilla del fondo
function updateGrid() {
  const gridContainer = document.getElementById('gridContainer');
  gridContainer.innerHTML = '';
  for (let i = 0; i < 16; i++) {
    const cell = document.createElement('div');
    cell.classList.add('grid-cell');
    gridContainer.appendChild(cell);
  }
}

// Funci√≥n para manejar logros
const achievements = [
  { id: 'firstLevel', name: 'Primer Nivel', description: 'Alcanza el nivel 2', check: () => petState.level >= 2, reward: 100 },
  { id: 'wellFed', name: 'Bien Alimentado', description: 'Mant√©n el hambre al 100% por 1 minuto', check: () => petState.hunger === 100, reward: 50 },
  { id: 'cleanFreak', name: 'Mani√°tico de la Limpieza', description: 'Mant√©n la higiene al 100% por 1 minuto', check: () => petState.hygiene === 100, reward: 50 },
  { id: 'partyAnimal', name: 'Alma de la Fiesta', description: 'Mant√©n la diversi√≥n al 100% por 1 minuto', check: () => petState.fun === 100, reward: 50 },
  { id: 'richPet', name: 'Mascota Rica', description: 'Acumula 1000 monedas', check: () => petState.currency >= 1000, reward: 200 }
];

let achievementTimers = {};

function checkAchievements() {
  achievements.forEach(achievement => {
    if (!petState.achievements) petState.achievements = {};
    if (!petState.achievements[achievement.id] && achievement.check()) {
      if (!achievementTimers[achievement.id]) {
        achievementTimers[achievement.id] = setTimeout(() => {
          petState.achievements[achievement.id] = true;
          petState.currency += achievement.reward;
          addEventToBar(`üèÜ ¬°Logro desbloqueado: ${achievement.name}!`, `Recompensa: ${achievement.reward} monedas`);
          saveGame();
        }, 60000); // 1 minuto
      }
    } else {
      if (achievementTimers[achievement.id]) {
        clearTimeout(achievementTimers[achievement.id]);
        delete achievementTimers[achievement.id];
      }
    }
  });
}

// Funci√≥n para crear una caca
function createPoop() {
  if (Math.random() < 0.1 && !petState.isDead && !petState.isPaused) {  // 10% de probabilidad cada vez que se llama
    const poops = document.querySelectorAll('.poop');
    if (poops.length >= 6) return; // No crear m√°s de 6 cacas

    const poop = document.createElement('div');
    poop.classList.add('poop');
    poop.textContent = 'üí©';
    poop.style.left = `${Math.random() * 80 + 10}%`;  // Posici√≥n aleatoria en el eje X
    poop.style.top = `${Math.random() * 80 + 10}%`;   // Posici√≥n aleatoria en el eje Y
    poop.style.fontSize = `${Math.random() * 20 + 20}px`; // Tama√±o aleatorio
    poop.style.zIndex = 11;

    poop.onclick = () => {
      poop.remove();
      petState.hygiene = Math.min(100, petState.hygiene + 5);
      petState.currency += 5;
      addEventToBar("üßπ Limpiaste una caca", "+5 monedas y +5% higiene");
      updateStatus();
      saveGame();
    };
    document.querySelector('.pet-frame').appendChild(poop);
  }
}

// Llamadas c√≠clicas a funciones
setInterval(handleSpecialEvents, DECREASE_INTERVAL);
setInterval(checkAchievements, 1000); // Cada segundo
setInterval(createPoop, 10000);

// Inicializar el juego cuando la p√°gina cargue
window.onload = function() {
  initializeGame();
  resizePet();
  window.addEventListener('resize', resizePet);
};

</script>

</body>
</html>
   
   

