<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¾ Neonpet Deluxe ğŸ¾</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(45deg, #ff00ff, #00ffff);
            --secondary-gradient: linear-gradient(45deg, #ff8a00, #e52e71);
            --neon-blue: #00ffff;
            --neon-pink: #ff00ff;
            --neon-yellow: #ffff00;
            --neon-green: #39ff14;
            --background-color: #1a0b2e;
            --overlay-color: rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--background-color);
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            position: relative;
            overflow: hidden;
            min-height: 100vh;
        }

        /* Overlay para atenuar la pantalla al morir */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--overlay-color);
            display: none;
            z-index: 15;
            transition: opacity 0.5s ease;
        }

        /* Clase para mostrar la overlay */
        .overlay.active {
            display: block;
            opacity: 1;
        }

        /* Clase para aplicar desenfoque cuando la luz estÃ¡ apagada */
        .blurred .game-container {
            filter: blur(5px);
            transition: filter 0.5s ease;
        }

        .frame {
            border: 2px solid var(--neon-blue);
            border-radius: 20px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 0 10px var(--neon-blue);
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .currency, .xp, .level, .weather {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--neon-yellow);
            text-shadow: 0 0 5px var(--neon-yellow);
            margin: 5px 0;
        }

        .status-bars {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .status-bar {
            width: 30%;
            min-width: 80px;
            text-align: center;
        }

        .bar-container {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 5px;
        }

        .status-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        #hunger-fill { background: var(--primary-gradient); }
        #fun-fill { background: var(--secondary-gradient); }
        #hygiene-fill { background: linear-gradient(45deg, #4facfe, #00f2fe); }

        .status-emoji {
            font-size: 1.5em;
        }

        .display-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .display-left, .display-right {
            width: 48%;
            border: 2px solid var(--neon-blue);
            border-radius: 10px;
            padding: 5px;
            height: 70px;
            overflow-y: auto;
        }

        .display-right {
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        .event-icon {
            font-size: 0.9em;
            margin-bottom: 5px;
            color: var(--neon-yellow);
            text-shadow: 0 0 5px var(--neon-yellow);
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .pet-frame {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            margin-bottom: 10px;
        }

        /* Clase para simetrÃ­a en la cuadrÃ­cula */
        .mini-game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 5px;
            width: 200px;
            height: 200px;
            margin: 20px auto;
        }

        .mini-game-cell {
            width: 100%;
            height: 100%;
            background-color: var(--neon-blue);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .mini-game-cell:active {
            transform: scale(0.95);
        }

        .pet-container {
            position: absolute;
            width: 30vh;
            height: 30vh;
            transition: transform 0.5s ease;
        }

        .pet {
            font-size: 15vh;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            filter: drop-shadow(0 0 5px var(--neon-yellow));
            user-select: none;
            transition: all 0.5s ease;
            cursor: pointer;
            z-index: 10;
        }

        .pet-accessory {
            position: absolute;
            font-size: 10vh;
            z-index: 11;
            cursor: move;
            transition: all 0.5s ease;
        }

        .accessory-crown { top: -5vh; left: 50%; transform: translateX(-50%); }
        .accessory-glasses { top: 4vh; left: 50%; transform: translateX(-50%); font-size: 11vh; }
        .accessory-hat { top: -5.5vh; left: 50%; transform: translateX(-50%); }

        .action-buttons {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            position: sticky;
            bottom: 0;
            background-color: var(--background-color);
        }

        .action-btn {
            font-size: 2em;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--neon-blue);
            border-radius: 10px;
            padding: 10px;
            color: white;
            text-shadow: 0 0 5px var(--neon-blue);
            transition: transform 0.2s ease;
            margin: 5px;
            flex: 1 1 80px;
            max-width: 100px;
            text-align: center;
            cursor: pointer;
        }

        .action-btn:active {
            transform: scale(0.9);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 20;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background-color: rgba(0,0,0,0.8);
        }

        .modal-content {
            background: var(--background-color);
            margin: 10% auto;
            padding: 20px;
            border: 2px solid var(--neon-blue);
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
            border-radius: 20px;
            box-shadow: 0 0 15px var(--neon-blue);
            position: relative;
        }

        .close, .close-chest {
            color: var(--neon-pink);
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover, .close-chest:hover,
        .close:focus, .close-chest:focus {
            color: var(--neon-yellow);
            text-decoration: none;
        }

        .chest-modal {
            display: none;
            position: fixed;
            z-index: 20;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background-color: rgba(0,0,0,0.7);
        }

        .chest-content {
            background-color: var(--background-color);
            margin: 15% auto;
            padding: 20px;
            border: 2px solid var(--neon-blue);
            width: 80%;
            max-width: 300px;
            border-radius: 10px;
            position: relative;
        }

        .chest-item {
            display: inline-block;
            font-size: 1.5em;
            margin: 5px;
            cursor: pointer;
        }

        .shop-items, .food-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .shop-item, .food-item {
            font-size: 1.2em;
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .shop-item:active, .food-item:active {
            transform: scale(0.95);
        }

        .chest, .shop-icon {
            font-size: 2em;
            cursor: pointer;
            margin: 0 15px;
        }

        .light-switch {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 12;
        }

        .poop {
            position: absolute;
            font-size: 3em;
            cursor: pointer;
            z-index: 9;
        }

        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: opacity 1s ease;
            z-index: 5;
        }

        /* Nuevas clases para los fondos */
        .background1 {
            background: linear-gradient(to bottom, #87CEEB, #E0F6FF); /* Azul cielo a azul claro */
        }

        .background2 {
            background: linear-gradient(to bottom, #FF7F50, #FFB6C1); /* Coral a rosa claro */
        }

        .background3 {
            background: linear-gradient(to bottom, #191970, #000000); /* Azul medianoche a negro */
        }

        .grid-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            z-index: 1;
        }

        .grid-cell {
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-sizing: border-box;
        }

        /* Estilos para bonus de caricia */
        .caress-bonus {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            color: var(--neon-yellow);
            font-size: 1em;
            animation: fadeOut 3s forwards;
            z-index: 20;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }

        @media (max-width: 600px) {
            .currency, .xp, .weather {
                font-size: 1em;
            }
            .action-btn {
                font-size: 1.5em;
                padding: 8px;
                max-width: 80px;
            }
            .pet {
                font-size: 12vh;
            }
            .pet-container {
                width: 25vh;
                height: 25vh;
            }
            .event-icon {
                font-size: 0.8em;
            }
            .action-buttons {
                justify-content: center;
            }
            .action-btn {
                flex: 1 1 70px;
                margin: 5px;
            }
            .close, .close-chest {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Overlay para la muerte de la mascota -->
        <div class="overlay" id="deathOverlay"></div>

        <div class="frame info-bar">
            <div class="currency" id="currency">ğŸ’° 2000</div>
            <div class="xp" id="xp">â­ 0</div>
            <div class="level" id="level">ğŸ”º Nivel 1</div>
            <div class="weather" id="weather">â˜€ï¸</div>
        </div>
        <div class="frame status-bars">
            <div class="status-bar">
                <div class="bar-container"><div id="hunger-fill" class="status-fill"></div></div>
                <div class="status-emoji">ğŸ”</div>
            </div>
            <div class="status-bar">
                <div class="bar-container"><div id="fun-fill" class="status-fill"></div></div>
                <div class="status-emoji">ğŸ‰</div>
            </div>
            <div class="status-bar">
                <div class="bar-container"><div id="hygiene-fill" class="status-fill"></div></div>
                <div class="status-emoji">ğŸš¿</div>
            </div>
        </div>
        <div class="display-container">
            <div class="display-left" id="eventBar"></div>
            <div class="display-right">
                <div class="shop-icon" id="shopIcon">ğŸª</div>
                <div class="chest" id="chest">ğŸ“¦</div>
            </div>
        </div>
        <div class="frame pet-frame">
            <!-- Clase inicial para el fondo -->
            <div class="background background1" id="background"></div>
            <div class="grid-container" id="gridContainer"></div>
            <div class="pet-container">
                <div class="pet" id="pet" draggable="true">ğŸ˜Š</div>
                <div id="crown" class="pet-accessory accessory-crown" draggable="true"></div>
                <div id="glasses" class="pet-accessory accessory-glasses" draggable="true"></div>
                <div id="hat" class="pet-accessory accessory-hat" draggable="true"></div>
            </div>
            <div class="light-switch" id="lightSwitch">ğŸ’¡</div>
        </div>
        <div class="action-buttons">
            <button class="action-btn" id="feed-btn">ğŸ½ï¸</button>
            <button class="action-btn" id="play-btn">ğŸ®</button>
            <button class="action-btn" id="clean-btn">ğŸ§¼</button>
        </div>

        <!-- Bonus por caricia -->
        <div class="caress-bonus" id="caressBonus" style="display: none;">
            ğŸ‰ Â¡Bonus por caricias activado! ğŸ‰
        </div>
    </div>
    
    <!-- Modales -->
    <div id="shopModal" class="modal">
        <div class="modal-content">
            <span class="close">âŒ</span>
            <h2>ğŸ›ï¸ Tienda</h2>
            <div class="shop-items" id="shop-items"></div>
        </div>
    </div>
    
    <div id="foodModal" class="modal">
        <div class="modal-content">
            <span class="close">âŒ</span>
            <h2>ğŸ½ï¸ Comida</h2>
            <div class="food-items" id="food-items"></div>
        </div>
    </div>
    
    <div id="miniGameModal" class="modal">
        <div class="modal-content">
            <span class="close">âŒ</span>
            <h2>ğŸ® Minijuego</h2>
            <div id="mini-game-board" class="mini-game-board"></div>
        </div>
    </div>
    
    <div id="chestModal" class="chest-modal">
        <div class="chest-content">
            <span class="close-chest" id="closeChest">âŒ</span>
            <h2>ğŸ“¦ Cofre</h2>
            <div id="chestItems"></div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- Tu script principal (se proporcionarÃ¡ en la siguiente respuesta) -->
    <script>
// ConfiguraciÃ³n de Firebase
// ConfiguraciÃ³n de Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBlIRJVI1buU48SPp0ErpCXhnuBdBEp8rk",
  authDomain: "tablon-de-anuncios-d5dea.firebaseapp.com",
  projectId: "tablon-de-anuncios-d5dea",
  storageBucket: "tablon-de-anuncios-d5dea.appspot.com",
  messagingSenderId: "67910184237",
  appId: "1:67910184237:web:e43d424657a948ae5d77a4",
  measurementId: "G-YL5W1VNM9Z"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Referencia del documento
const petDocRef = db.collection('pet').doc('status');

// Variables globales
let petState = {
  hunger: 100,
  fun: 100,
  hygiene: 100,
  currency: 2000,
  xp: 0,
  level: 1,
  isSick: false,
  isDead: false,
  caressCount: 0,
  chestItems: [],
  shampooCount: 0,
  isLightOn: true,
  accessories: {
    crown: '',
    glasses: '',
    hat: ''
  },
  expression: 'ğŸ˜Š',
  currentBackground: 1
};

// Flags para el cambio de expresiÃ³n
let isCyclingExpression = false;
let expressionInterval = null;

// Variables para el swipe de fondos
let touchStartX = 0;
let touchEndX = 0;
const swipeThreshold = 50;
const totalBackgrounds = 3;

// Elementos del DOM
const pet = document.getElementById('pet');
const petContainer = document.querySelector('.pet-container');
const crown = document.getElementById('crown');
const glasses = document.getElementById('glasses');
const hat = document.getElementById('hat');
const hungerFill = document.getElementById('hunger-fill');
const funFill = document.getElementById('fun-fill');
const hygieneFill = document.getElementById('hygiene-fill');
const currencyElement = document.getElementById('currency');
const xpElement = document.getElementById('xp');
let levelElement = document.getElementById('level');
const weatherElement = document.getElementById('weather');
const eventBar = document.getElementById('eventBar');
const chest = document.getElementById('chest');
const lightSwitch = document.getElementById('lightSwitch');
const background = document.getElementById('background');
const deathOverlay = document.getElementById('deathOverlay');
const caressBonus = document.getElementById('caressBonus');

// Botones de acciÃ³n
const feedBtn = document.getElementById('feed-btn');
const playBtn = document.getElementById('play-btn');
const cleanBtn = document.getElementById('clean-btn');
const shopIcon = document.getElementById('shopIcon');

// Modales
const shopModal = document.getElementById('shopModal');
const foodModal = document.getElementById('foodModal');
const miniGameModal = document.getElementById('miniGameModal');
const chestModal = document.getElementById('chestModal');
const chestItemsContainer = document.getElementById('chestItems');
const closeChest = document.getElementById('closeChest');

// Emojis
const petEmojis = ['ğŸ˜Š', 'ğŸ˜„', 'ğŸ˜', 'ğŸ¤”', 'ğŸ˜´', 'ğŸ˜‹', 'ğŸ˜', 'ğŸ¤“', 'ğŸ¥³', 'ğŸ˜', 'ğŸ¤ª', 'ğŸ˜‡', 'ğŸ¥°', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ˜³', 'ğŸ™„', 'ğŸ˜¬', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜­', 'ğŸ˜±', 'ğŸ¤¯', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜“', 'ğŸ¤—', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤¥', 'ğŸ˜¶', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¬', 'ğŸ™„', 'ğŸ˜¯', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜®', 'ğŸ˜²', 'ğŸ¥±', 'ğŸ˜´', 'ğŸ¤¤', 'ğŸ˜ª', 'ğŸ˜µ'];
const weatherEmojis = ['â˜€ï¸', 'ğŸŒ§ï¸', 'â„ï¸', 'ğŸŒ¤ï¸', 'ğŸŒˆ'];
let currentpetEmojiIndex = 0;
let currentWeatherIndex = 0;

// Items
const shopItems = [
  { emoji: 'ğŸ‘‘', price: 500, type: 'crown', requiredLevel: 5 },
  { emoji: 'ğŸ‘“', price: 300, type: 'glasses', requiredLevel: 3 },
  { emoji: 'ğŸ§¢', price: 200, type: 'hat', requiredLevel: 2 },
  { emoji: 'ğŸ©', price: 1000, type: 'topHat', requiredLevel: 10 },
  { emoji: 'ğŸ§´', price: 50, type: 'shampoo', requiredLevel: 1 },
  { emoji: 'ğŸ’Š', price: 100, type: 'medicine', requiredLevel: 1 },
  { emoji: 'ğŸ¥½', price: 800, type: 'goggles', requiredLevel: 8 }
];

const foodItems = [
  { emoji: 'ğŸ', hunger: 10, price: 50, requiredLevel: 1 },
  { emoji: 'ğŸ”', hunger: 25, price: 100, requiredLevel: 2 },
  { emoji: 'ğŸ•', hunger: 20, price: 150, requiredLevel: 3 },
  { emoji: 'ğŸ¦', hunger: 5, price: 80, requiredLevel: 1 },
  { emoji: 'ğŸ¥—', hunger: 15, price: 120, requiredLevel: 2 },
  { emoji: 'ğŸ±', hunger: 30, price: 200, requiredLevel: 4 },
  { emoji: 'ğŸ‰', hunger: 12, price: 70, requiredLevel: 1 },
  { emoji: 'ğŸ—', hunger: 28, price: 180, requiredLevel: 3 },
  { emoji: 'ğŸ£', hunger: 22, price: 160, requiredLevel: 5 },
  { emoji: 'ğŸ¥©', hunger: 35, price: 250, requiredLevel: 6 },
  { emoji: 'ğŸ°', hunger: 18, price: 140, requiredLevel: 4 }
];

const backgrounds = [
  'background1',
  'background2',
  'background3'
];

// Frases variadas para la interfaz
const phrases = {
  feed: [
    "Â¡QuÃ© rico! ğŸ˜‹",
    "Â¡Gracias por la comida! ğŸ½ï¸",
    "Â¡Estaba delicioso! ğŸ¤¤",
    "Â¡Justo lo que necesitaba! ğŸ´",
    "Â¡Mmm, mi favorito! ğŸ˜",
    "Â¡Cakiwaki estÃ¡ satisfecho! ğŸ¥°",
    "Â¡EnergÃ­a renovada! ğŸ’ª",
    "Â¡Cakiwaki dice gracias! ğŸ™",
    "Â¡Esto sabe a felicidad! ğŸ˜Š",
    "Â¡Comida de campeones! ğŸ†"
  ],
  play: [
    "Â¡QuÃ© divertido! ğŸ‰",
    "Â¡Me encanta jugar contigo! ğŸ¥³",
    "Â¡Eres el mejor compaÃ±ero de juegos! ğŸ®",
    "Â¡Otra vez, otra vez! ğŸ”„",
    "Â¡Esto es genial! ğŸ¤©",
    "Â¡Cakiwaki estÃ¡ muy feliz! ğŸ˜„",
    "Â¡DiversiÃ³n al mÃ¡ximo! ğŸˆ",
    "Â¡Cakiwaki quiere mÃ¡s juegos! ğŸ•¹ï¸",
    "Â¡Jugando se aprende! ğŸ“š",
    "Â¡Risas y diversiÃ³n sin fin! ğŸ˜†"
  ],
  clean: [
    "Â¡QuÃ© fresquito! ğŸ§¼",
    "Â¡Gracias por el baÃ±o! ğŸš¿",
    "Â¡Me siento como nuevo! âœ¨",
    "Â¡AdiÃ³s, suciedad! ğŸ‘‹",
    "Â¡Ahora estoy reluciente! ğŸ’",
    "Â¡Cakiwaki estÃ¡ limpio y feliz! ğŸ§½",
    "Â¡QuÃ© bien huele Cakiwaki! ğŸŒ¸",
    "Â¡BaÃ±o refrescante para Cakiwaki! ğŸ›",
    "Â¡Limpio por fuera, feliz por dentro! ğŸ˜Š",
    "Â¡Un Cakiwaki limpio es un Cakiwaki feliz! ğŸŒŸ"
  ],
  caress: [
    "Â¡Me encantan tus caricias! ğŸ’–",
    "Â¡QuÃ© agradable! ğŸ˜Š",
    "Â¡MÃ¡s, por favor! ğŸ¥°",
    "Â¡Eres el mejor! ğŸŒŸ",
    "Â¡Me haces tan feliz! ğŸ˜„",
    "Â¡Cakiwaki se siente amado! â¤ï¸",
    "Â¡CariÃ±os para Cakiwaki! ğŸ¤—",
    "Â¡Cakiwaki ronronea de felicidad! ğŸ˜º",
    "Â¡Tus caricias son mÃ¡gicas! âœ¨",
    "Â¡Cakiwaki se derrite de amor! ğŸ’“"
  ],
  levelUp: [
    "Â¡SubÃ­ de nivel! ğŸŠ",
    "Â¡Cada vez mÃ¡s fuerte! ğŸ’ª",
    "Â¡Mira lo grande que estoy! ğŸ“",
    "Â¡Gracias por cuidarme tan bien! ğŸ†",
    "Â¡Somos un gran equipo! ğŸ¤",
    "Â¡Cakiwaki evoluciona! ğŸŒŸ",
    "Â¡Nuevo nivel desbloqueado! ğŸ”“",
    "Â¡Cakiwaki se hace mÃ¡s poderoso! ğŸ’¥",
    "Â¡Un paso mÃ¡s hacia la grandeza! ğŸš€",
    "Â¡Cakiwaki alcanza nuevas alturas! ğŸ”ï¸"
  ],
  random: [
    "Â¿Jugamos a algo? ğŸ²",
    "Tengo ganas de aventuras ğŸ—ºï¸",
    "Â¿Me cuentas un chiste? ğŸ˜†",
    "Â¿QuÃ© tal si bailamos? ğŸ’ƒ",
    "Me pregunto quÃ© habrÃ¡ en el cofre... ğŸ¤”",
    "Cakiwaki tiene una idea loca ğŸ’¡",
    "Â¿PodrÃ­as traerle una sopita a Cakiwaki? ğŸ²",
    "Cakiwaki quiere explorar el mundo ğŸŒ",
    "Â¿Podemos hacer un picnic virtual? ğŸ§º",
    "Cakiwaki sueÃ±a con ser una estrella ğŸŒ ",
    "Â¿QuÃ© tal si inventamos un nuevo juego? ğŸ¯",
    "Cakiwaki quiere hacer un desfile de moda ğŸ‘—",
    "Â¿Podemos tener una fiesta de pijamas? ğŸ›ï¸",
    "Cakiwaki quiere aprender a cocinar ğŸ‘¨â€ğŸ³",
    "Â¿Y si construimos un fuerte de almohadas? ğŸ°"
  ],
  sick: [
    "Cakiwaki no se siente muy bien ğŸ¤’",
    "Â¿Puedes cuidar de Cakiwaki? ğŸ¤§",
    "Cakiwaki necesita descansar ğŸ˜´",
    "Un poco de medicina ayudarÃ­a ğŸ’Š",
    "Cakiwaki tiene escalofrÃ­os ğŸ¥¶",
    "Cakiwaki necesita un abrazo reconfortante ğŸ¤—",
    "Â¿PodrÃ­as traerle una sopita a Cakiwaki? ğŸ²",
    "Cakiwaki se siente dÃ©bil ğŸ˜”",
    "Un dÃ­a de reposo harÃ¡ bien a Cakiwaki ğŸ›Œ",
    "Cakiwaki necesita mimos extra hoy ğŸ¥º"
  ],
  dead: [
    "ğŸ’€ Cakiwaki ha muerto. RevÃ­velo con comida."
  ]
};

// FunciÃ³n para obtener una frase aleatoria
function getRandomPhrase(category) {
  if (category === 'dead') {
    return phrases.dead[0];
  }
  return phrases[category][Math.floor(Math.random() * phrases[category].length)];
}

// Funciones principales
function updateStatus() {
  petState.hunger = Math.max(0, Math.min(100, petState.hunger));
  petState.fun = Math.max(0, Math.min(100, petState.fun));
  petState.hygiene = Math.max(0, Math.min(100, petState.hygiene));

  hungerFill.style.width = `${petState.hunger}%`;
  funFill.style.width = `${petState.fun}%`;
  hygieneFill.style.width = `${petState.hygiene}%`;

  currencyElement.textContent = `ğŸ’° ${petState.currency}`;
  xpElement.textContent = `â­ ${petState.xp}`;

  if (levelElement) {
    levelElement.textContent = `ğŸ”º Nivel ${petState.level}`;
  } else {
    levelElement = document.createElement('div');
    levelElement.classList.add('level');
    levelElement.id = 'level';
    levelElement.style.fontSize = '1.2em';
    levelElement.style.fontWeight = 'bold';
    levelElement.style.color = 'var(--neon-yellow)';
    levelElement.style.textShadow = '0 0 5px var(--neon-yellow)';

    const infoBar = document.querySelector('.info-bar');
    const weatherElement = document.getElementById('weather');
    infoBar.insertBefore(levelElement, weatherElement);
    levelElement.textContent = `ğŸ”º Nivel ${petState.level}`;
  }

  updatePetExpression();
  updatePetAppearance();
  resizePet();
  applyBlurEffect();
}

function changeExpression(newExpression) {
  if (pet) {
    pet.textContent = newExpression;
    petState.expression = newExpression;
    updateFirestore();
  } else {
    console.error("Elemento 'pet' no encontrado");
  }
}

function updatePetExpression() {
  if (petState.isDead) {
    changeExpression(Math.random() < 0.5 ? 'ğŸ’€' : 'ğŸ‘¹');
    return;
  }

  if (isCyclingExpression) {
    return;
  }

  if (!petState.isLightOn) {
    changeExpression('ğŸ˜´');
  } else if (petState.isSick) {
    changeExpression('ğŸ¤’');
  } else if (petState.hunger <= 30 || petState.fun <=30 || petState.hygiene <= 30) {
  changeExpression('ğŸ˜¢');
  } else {
  changePetFace();
  }
  }
  
  function changePetFace() {
  if (!petState.isSick && petState.isLightOn) {
  currentpetEmojiIndex = Math.floor(Math.random() * petEmojis.length);
  changeExpression(petEmojis[currentpetEmojiIndex]);
  }
  }
  
  function decreaseStats() {
  if (petState.isDead) return;
  
  const decreaseAmountHunger = 1;
  const decreaseAmountFun = 0.8;
  const decreaseAmountHygiene = 0.7;
  
  petState.hunger = Math.max(0, petState.hunger - decreaseAmountHunger);
  petState.fun = Math.max(0, petState.fun - decreaseAmountFun);
  petState.hygiene = Math.max(0, petState.hygiene - decreaseAmountHygiene);
  
  if (petState.hunger <= 0) {
  addEventToBar(getRandomPhrase('dead'), "ğŸ’€ Cakiwaki ha muerto de hambre.");
  petDeath();
  }
  
  randomSickness();
  updateStatus();
  }
  
  function addEventToBar(message, additionalInfo = "") {
  const eventIcon = document.createElement('div');
  eventIcon.classList.add('event-icon');
  eventIcon.innerHTML = `${message}<br><small>${additionalInfo}</small>`;
  eventIcon.style.fontSize = '0.8em';
  eventBar.insertBefore(eventIcon, eventBar.firstChild);
  
  while (eventBar.childNodes.length > 5) {
  eventBar.removeChild(eventBar.lastChild);
  }
  }
  
  function changeWeather() {
  if (petState.isDead) return;
  
  currentWeatherIndex = (currentWeatherIndex + 1) % weatherEmojis.length;
  weatherElement.textContent = weatherEmojis[currentWeatherIndex];
  applyWeatherEffects();
  }
  
  function applyWeatherEffects() {
  switch(weatherEmojis[currentWeatherIndex]) {
  case 'â˜€ï¸':
  petState.fun = Math.min(100, petState.fun + 5);
  petState.hygiene = Math.max(0, petState.hygiene - 5);
  addEventToBar("â˜€ï¸ DÃ­a soleado, Â¡Cakiwaki quiere jugar afuera!", "El sol anima a Cakiwaki, pero ten cuidado con el sudor.");
  break;
  case 'ğŸŒ§ï¸':
  petState.hygiene = Math.min(100, petState.hygiene + 10);
  petState.fun = Math.max(0, petState.fun - 5);
  if (Math.random() < 0.2 && !petState.isSick) {
  petState.isSick = true;
  addEventToBar(getRandomPhrase('sick'), "La lluvia puede enfermar a Cakiwaki. Considera darle medicina.");
  petState.fun = Math.max(0, petState.fun - 20);
  }
  addEventToBar("ğŸŒ§ï¸ DÃ­a lluvioso, Â¡Cakiwaki se da un baÃ±o natural!", "La lluvia limpia a Cakiwaki, pero puede aburrirlo un poco.");
  break;
  case 'â„ï¸':
  petState.hunger = Math.min(100, petState.hunger + 10);
  if (Math.random() < 0.3 && !petState.isSick) {
  petState.isSick = true;
  addEventToBar(getRandomPhrase('sick'), "El frÃ­o puede enfermar a Cakiwaki. Mantenlo caliente y dale medicina si es necesario.");
  }
  addEventToBar("â„ï¸ DÃ­a frÃ­o, Cakiwaki necesita mÃ¡s energÃ­a", "El frÃ­o aumenta el apetito de Cakiwaki. AsegÃºrate de alimentarlo bien.");
  break;
  case 'ğŸŒ¤ï¸':
  petState.currency += 50;
  addEventToBar("ğŸŒ¤ï¸ğŸ’° DÃ­a despejado, Â¡Cakiwaki encontrÃ³ monedas brillando al sol!", "Â¡QuÃ© suerte! Usa estas monedas sabiamente para cuidar mejor a Cakiwaki.");
  break;
  case 'ğŸŒˆ':
  petState.fun = Math.min(100, petState.fun + 15);
  petState.currency += 100;
  addEventToBar("ğŸŒˆğŸ’° Â¡ArcoÃ­ris! Cakiwaki estÃ¡ feliz y encontrÃ³ un tesoro", "Los arcoÃ­ris traen alegrÃ­a y fortuna. Â¡Aprovecha este momento especial!");
  break;
  }
  updateStatus();
  }
  
  function gainXP(amount) {
  petState.xp += amount;
  if (petState.xp >= petState.level * 100) {
  levelUp();
  } else {
  addEventToBar(`â­ +${amount} XP`, "Â¡Sigue asÃ­! Cada punto de experiencia te acerca al siguiente nivel.");
  }
  updateStatus();
  }
  
  function levelUp() {
  petState.level++;
  petState.xp = 0;
  addEventToBar(getRandomPhrase('levelUp'), "Â¡IncreÃ­ble progreso! Cada nivel desbloquea nuevas posibilidades para Cakiwaki.");
  petState.currency += petState.level * 50;
  updateStatus();
  }
  
  // Event listeners para botones
  feedBtn.addEventListener('click', () => {
  foodModal.style.display = 'block';
  updateFoodMenu();
  });
  
  playBtn.addEventListener('click', () => {
  miniGameModal.style.display = 'block';
  startRandomMiniGame();
  });
  
  cleanBtn.addEventListener('click', () => {
  cleanPet();
  });
  
  shopIcon.addEventListener('click', () => {
  shopModal.style.display = 'block';
  updateShopItems();
  });
  
  lightSwitch.addEventListener('click', () => {
  petState.isLightOn = !petState.isLightOn;
  lightSwitch.textContent = petState.isLightOn ? 'ğŸ’¡' : 'ğŸŒ™';
  addEventToBar(petState.isLightOn ? "ğŸ’¡ Luz encendida" : "ğŸŒ™ Luz apagada", petState.isLightOn ? "Cakiwaki puede jugar y divertirse ahora." : "Cakiwaki descansarÃ¡ mejor en la oscuridad.");
  
  applyBlurEffect();
  updateStatus();
  });
  
  chest.addEventListener('click', () => {
  chestModal.style.display = 'block';
  updateChestItems();
  });
  
  closeChest.addEventListener('click', () => {
  chestModal.style.display = 'none';
  });
  
  // FunciÃ³n para bonificaciÃ³n por caricias

  
  function showCaressBonusNotification() {
  caressBonus.style.display = 'block';
  setTimeout(() => {
  caressBonus.style.display = 'none';
  }, 3000);
  }
  
  // Event listener para tap en la mascota
  pet.addEventListener('click', () => {
  if (petState.isDead || !petState.isLightOn) return;
  
  toggleCyclingExpressions();
  caressBonus();
  });
  
  function updateShopItems() {
  const shopItemsContainer = document.getElementById('shop-items');
  shopItemsContainer.innerHTML = '';
  shopItems.forEach(item => {
  const itemElement = document.createElement('div');
  itemElement.classList.add('shop-item');
  itemElement.innerHTML = `${item.emoji}<br>ğŸ’°${item.price}<br>Nivel ${item.requiredLevel}`;
  itemElement.onclick = () => buyItem(item);
  if (petState.level < item.requiredLevel || petState.currency < item.price) {
  itemElement.style.opacity = '0.5';
  itemElement.style.cursor = 'not-allowed';
  }
  shopItemsContainer.appendChild(itemElement);
  });
  }
  
  function updateFoodMenu() {
  const foodItemsContainer = document.getElementById('food-items');
  foodItemsContainer.innerHTML = '';
  foodItems.forEach(item => {
  const itemElement = document.createElement('div');
  itemElement.classList.add('food-item');
  itemElement.innerHTML = `${item.emoji}<br>ğŸ’°${item.price}<br>Nivel ${item.requiredLevel}`;
  itemElement.onclick = () => feedPet(item);
  if (petState.level < item.requiredLevel || petState.currency < item.price) {
  itemElement.style.opacity = '0.5';
  itemElement.style.cursor = 'not-allowed';
  }
  foodItemsContainer.appendChild(itemElement);
  });
  }
  
  function buyItem(item) {
  if (petState.currency >= item.price && petState.level >= item.requiredLevel) {
  petState.currency -= item.price;
  switch(item.type) {
  case 'crown':
  crown.textContent = item.emoji;
  petState.accessories.crown = item.emoji;
  addEventToBar(`ğŸ‘‘ Â¡Cakiwaki ahora lleva una corona!`, "La realeza le sienta bien a Cakiwaki.");
  break;
  case 'glasses':
  case 'goggles':
  glasses.textContent = item.emoji;
  petState.accessories.glasses = item.emoji;
  addEventToBar(`ğŸ‘“ Â¡Cakiwaki tiene nuevas gafas!`, "Ahora Cakiwaki puede ver el mundo de una nueva manera.");
  break;
  case 'hat':
  case 'topHat':
  hat.textContent = item.emoji;
  petState.accessories.hat = item.emoji;
  addEventToBar(`ğŸ© Â¡Cakiwaki tiene un nuevo sombrero!`, "Â¡QuÃ© elegante se ve Cakiwaki con su nuevo sombrero!");
  break;
  case 'shampoo':
  petState.shampooCount++;
  addEventToBar(`ğŸ§´ Has comprado shampoo`, "Mantener limpio a Cakiwaki serÃ¡ mÃ¡s fÃ¡cil ahora.");
  break;
  case 'medicine':
  if (petState.isSick) {
  petState.isSick = false;
  addEventToBar("ğŸ’Š Cakiwaki se ha curado", "Â¡Bien hecho! Cakiwaki se siente mucho mejor gracias a ti.");
  } else {
  addEventToBar("ğŸ’Š Guardaste la medicina para mÃ¡s tarde", "Es bueno estar preparado. PodrÃ¡s usar la medicina cuando Cakiwaki se enferme.");
  petState.chestItems.push(item.emoji);
  }
  break;
  }
  addEventToBar(`ğŸ›ï¸ Compraste: ${item.emoji}`, "Â¡Buena compra! Estos artÃ­culos harÃ¡n la vida de Cakiwaki mÃ¡s interesante.");
  gainXP(10);
  updateFirestore();
  shopModal.style.display = 'none';
  } else if (petState.level < item.requiredLevel) {
  addEventToBar(`âŒ Necesitas nivel ${item.requiredLevel} para comprar esto.`, "Sigue cuidando a Cakiwaki para subir de nivel y desbloquear nuevos artÃ­culos.");
  } else {
  addEventToBar("âŒ No tienes suficientes monedas.", "Juega minijuegos o completa logros para ganar mÃ¡s monedas.");
  }
  }
  
  function feedPet(food) {
  if (petState.currency >= food.price && petState.level >= food.requiredLevel) {
  petState.currency -= food.price;
  if (petState.isDead) {
  petState.isDead = false;
  petState.hunger = 50;
  petState.fun = 50;
  petState.hygiene = 50;
  petState.level = 1;
  petState.xp = 0;
  addEventToBar("ğŸ‰ Cakiwaki ha revivido!", "Â¡IncreÃ­ble! Has traÃ­do a Cakiwaki de vuelta. CuÃ­dalo bien esta vez.");
  deathOverlay.classList.remove('active');
  applyBlurEffect();
  } else {
  petState.hunger = Math.min(100, petState.hunger + food.hunger);
  }
  addEventToBar(getRandomPhrase('feed'), "Alimentar a Cakiwaki regularmente lo mantendrÃ¡ feliz y saludable.");
  gainXP(5);
  if (petState.hunger > 100) {
  petState.isSick = true;
  addEventToBar("ğŸ¤¢ Cakiwaki comiÃ³ demasiado", "Â¡Uh oh! Parece que Cakiwaki se excediÃ³. Un poco de descanso lo ayudarÃ¡ a sentirse mejor.");
  }
  updateFirestore();
  foodModal.style.display = 'none';
  } else if (petState.level < food.requiredLevel) {
  addEventToBar(`âŒ Necesitas nivel ${food.requiredLevel}`, "Sigue jugando y cuidando a Cakiwaki para desbloquear mÃ¡s opciones de comida.");
  } else {
  addEventToBar("ğŸ’°âŒ No tienes suficientes monedas", "Â¡No te desanimes! Juega minijuegos o completa logros para ganar mÃ¡s monedas.");
  }
  }
  
  function cleanPet() {
  if (petState.shampooCount > 0) {
  petState.hygiene = Math.min(100, petState.hygiene + 40);
  petState.shampooCount--;
  petState.currency += 10;
  addEventToBar(getRandomPhrase('clean'), "Mantener a Cakiwaki limpio lo hace mÃ¡s feliz y saludable. Â¡Buen trabajo!");
  
  const poops = document.querySelectorAll('.poop');
  poops.forEach(poop => poop.remove());
  if (poops.length > 3) {
  addEventToBar("ğŸ§¼ Â¡Gran limpieza!", "Has eliminado muchas cacas. Cakiwaki se siente mucho mejor ahora.");
  }
  
  gainXP(5);
  updateFirestore();
  } else {
  addEventToBar("âŒ No tienes shampoo", "Puedes comprar mÃ¡s shampoo en la tienda. Â¡Mantener la higiene es importante!");
  }
  }
  
  function startRandomMiniGame() {
  const games = [startCatchEmojiGame, startFollowEmojiGame, startMemoryGame];
  const randomGame = games[Math.floor(Math.random() * games.length)];
  randomGame();
  }
  
  function startCatchEmojiGame() {
  const miniGameBoard = document.getElementById('mini-game-board');
  miniGameBoard.innerHTML = '';
  miniGameBoard.style.gridTemplateColumns = 'repeat(4, 1fr)';
  miniGameBoard.style.gridTemplateRows = 'repeat(4, 1fr)';
  
  const targetEmoji = 'ğŸ¯';
  let score = 0;
  let timeLeft = 30;
  
  const scoreDisplay = document.createElement('div');
  scoreDisplay.textContent = `PuntuaciÃ³n: ${score}`;
  miniGameBoard.appendChild(scoreDisplay);
  
  const timeDisplay = document.createElement('div');
  timeDisplay.textContent = `Tiempo: ${timeLeft}s`;
  miniGameBoard.appendChild(timeDisplay);
  
  for (let i = 0; i < 16; i++) {
  const cell = document.createElement('div');
  cell.classList.add('mini-game-cell');
  miniGameBoard.appendChild(cell);
  }
  
  function placeTarget() {
  const cells = miniGameBoard.querySelectorAll('.mini-game-cell');
  cells.forEach(cell => {
  cell.textContent = '';
  cell.onclick = null;
  });
  const randomCell = cells[Math.floor(Math.random() * cells.length)];
  randomCell.textContent = targetEmoji;
  randomCell.onclick = () => {
  score++;
  gainXP(2);
  addEventToBar("ğŸ¯ Â¡Has alcanzado el objetivo!", "Â¡Bien hecho! Sigue asÃ­ para conseguir una gran puntuaciÃ³n.");
  scoreDisplay.textContent = `PuntuaciÃ³n: ${score}`;
  placeTarget();
  };
  }
  
  placeTarget();
  
  const timerInterval = setInterval(() => {
  timeLeft--;
  timeDisplay.textContent = `Tiempo: ${timeLeft}s`;
  if (timeLeft <= 0) {
  clearInterval(timerInterval);
  endCatchEmojiGame();
  }
  }, 1000);
  
  function endCatchEmojiGame() {
  addEventToBar(`ğŸ Fin del juego: PuntuaciÃ³n = ${score}`, "Â¡Gran partida! Jugar minijuegos ayuda a Cakiwaki a divertirse y ganar recompensas.");
  petState.fun = Math.min(100, petState.fun + score * 2);
  petState.currency += score * 10;
  gainXP(score);
  updateFirestore();
  miniGameModal.style.display = 'none';
  }
  }
  
  function startFollowEmojiGame() {
  const miniGameBoard = document.getElementById('mini-game-board');
  miniGameBoard.innerHTML = '';
  miniGameBoard.style.gridTemplateColumns = 'repeat(4, 1fr)';
  miniGameBoard.style.gridTemplateRows = 'repeat(4, 1fr)';
  
  const targetEmoji = 'ğŸ¯';
  let score = 0;
  let timeLeft = 15;
  let currentTargetCell = null;
  
  const scoreDisplay = document.createElement('div');
  scoreDisplay.textContent = `PuntuaciÃ³n: ${score}`;
  miniGameBoard.appendChild(scoreDisplay);
  
  const timeDisplay = document.createElement('div');
  timeDisplay.textContent = `Tiempo: ${timeLeft}s`;
  miniGameBoard.appendChild(timeDisplay);
  
  for (let i = 0; i < 16; i++) {
  const cell = document.createElement('div');
  cell.classList.add('mini-game-cell');
  miniGameBoard.appendChild(cell);
  }
  
  function placeTarget() {
  const cells = miniGameBoard.querySelectorAll('.mini-game-cell');
  cells.forEach(cell => cell.textContent = '');
  const randomIndex = Math.floor(Math.random() * cells.length);
  currentTargetCell = cells[randomIndex];
  currentTargetCell.textContent = targetEmoji;
  currentTargetCell.onclick = () => {
  score++;
  gainXP(2);
  addEventToBar("ğŸ¯ Â¡Has alcanzado el objetivo!", "Â¡Excelentes reflejos! Sigue asÃ­ para mejorar tu puntuaciÃ³n.");
  scoreDisplay.textContent = `PuntuaciÃ³n: ${score}`;
  placeTarget();
  };
  }
  
  placeTarget();
  
  const timerInterval = setInterval(() => {
  timeLeft--;
  timeDisplay.textContent = `Tiempo: ${timeLeft}s`;
  if (timeLeft <= 0) {
  clearInterval(timerInterval);
  endFollowEmojiGame();
  } else {
  placeTarget();
  }
  }, 1000);
  
  function endFollowEmojiGame() {
  addEventToBar(`ğŸ Fin del juego: PuntuaciÃ³n = ${score}`, "Â¡Buen juego! Tus reflejos rÃ¡pidos han impresionado a Cakiwaki.");
  petState.fun = Math.min(100, petState.fun + score * 2);
  petState.currency += score * 10;
  gainXP(score);
  updateFirestore();
  miniGameModal.style.display = 'none';
  }
  }
  
  function startMemoryGame() {
  const miniGameBoard = document.getElementById('mini-game-board');
  miniGameBoard.innerHTML = '';
  miniGameBoard.style.gridTemplateColumns = 'repeat(4, 1fr)';
  miniGameBoard.style.gridTemplateRows = 'repeat(4, 1fr)';
  
  const emojis = ['ğŸ', 'ğŸŒ', 'ğŸ’', 'ğŸ“', 'ğŸŠ', 'ğŸ‹', 'ğŸ‰', 'ğŸ‡'];
  const gameEmojis = [...emojis, ...emojis];
  gameEmojis.sort(() => Math.random() - 0.5);
  
  let flippedCards = [];
  let matchedPairs = 0;
  let canFlip = true;
  
  for (let i = 0; i < 16; i++) {
  const cell = document.createElement('div');
  cell.classList.add('mini-game-cell');
  cell.textContent = 'â“';
  cell.addEventListener('click', () => {
  if (canFlip && cell.textContent === 'â“' && flippedCards.length < 2) {
  cell.textContent = gameEmojis[i];
  flippedCards.push(cell);
  
  if (flippedCards.length === 2) {
  canFlip = false;
  setTimeout(checkMatch, 1000);
  }
  }
  });
  miniGameBoard.appendChild(cell);
  }
  
  function checkMatch() {
  const [card1, card2] = flippedCards;
  if (card1.textContent === card2.textContent) {
  matchedPairs++;
  gainXP(5);
  addEventToBar("ğŸ‰ Â¡Encontraste un par!", "Â¡Buena memoria! Sigue asÃ­ para completar el juego.");
  if (matchedPairs === 8) {
  endMemoryGame();
  }
  } else {
  card1.textContent = 'â“';
  card2.textContent = 'â“';
  }
  flippedCards = [];
  canFlip = true;
  }
  
  function endMemoryGame() {
  addEventToBar("ğŸ† Â¡Has completado el juego de memoria!", "Â¡IncreÃ­ble trabajo! Tu memoria ha impresionado a Cakiwaki.");
  petState.fun = Math.min(100, petState.fun + 30);
  petState.currency += 100;
  gainXP(50);
  updateFirestore();
  miniGameModal.style.display = 'none';
  }
  }
  
  function updateChestItems() {
  chestItemsContainer.innerHTML = '';
  petState.chestItems.forEach(item => {
  const itemElement = document.createElement('div');
  itemElement.classList.add('chest-item');
  itemElement.textContent = item;
  itemElement.onclick = () => equipItem(item);
  chestItemsContainer.appendChild(itemElement);
  });
  }
  
  function equipItem(item) {
  const accessoryType = getAccessoryType(item);
  if (accessoryType) {
  switch(accessoryType) {
  case 'crown':
  crown.textContent = item;
  petState.accessories.crown = item;
  break;
  case 'glasses':
  glasses.textContent = item;
  petState.accessories.glasses = item;
  break;
  case 'hat':
  hat.textContent = item;
  petState.accessories.hat = item;
  break;
  }
  addEventToBar(`${item} equipado!`, "Â¡Cakiwaki luce genial con su nuevo accesorio!");
  gainXP(5);
  } else if (item === 'ğŸ§´') {
  petState.shampooCount++;
  addEventToBar(`ğŸ§´ Shampoo aÃ±adido`, "Ahora puedes dar un baÃ±o refrescante a Cakiwaki.");
  gainXP(2);
  } else if (item === 'ğŸ’Š') {
  if (petState.isSick) {
  petState.isSick = false;
  addEventToBar("ğŸ’Š Cakiwaki se ha curado", "Â¡Bien hecho! Has ayudado a Cakiwaki a recuperarse.");
  } else {
  addEventToBar("ğŸ’Š No es necesario usar la medicina ahora", "Guarda la medicina para cuando Cakiwaki realmente la necesite.");
  }
  gainXP(5);
  }
  petState.chestItems = petState.chestItems.filter(i => i !== item);
  updateChestItems();
  updateFirestore();
  }
  
  function getAccessoryType(emoji) {
  switch(emoji) {
  case 'ğŸ‘‘': return 'crown';
  case 'ğŸ‘“': case 'ğŸ¥½': return 'glasses';
  case 'ğŸ§¢': case 'ğŸ©': return 'hat';
  default: return null;
  }
  }
  
  function updateFirestore() {
  petDocRef.set(petState, { merge: true })
  .then(() => {
  console.log("Datos actualizados correctamente en Firebase");
  })
  .catch((error) => {
  console.error("Error al actualizar los datos en Firebase:", error);
  });
  }
  
  function initializeNewGame() {
  petState = {
  hunger: 100,
  fun: 100,
  hygiene: 100,
  currency: 2000,
  xp: 0,
  level: 1,
  isSick: false,
  isDead: false,
  caressCount: 0,
  chestItems: [],
  shampooCount: 0,
  isLightOn: true,
  accessories: {
  crown: '',
  glasses: '',
  hat: ''
  },
  expression: 'ğŸ˜Š',
  currentBackground: 1
  };
  
  petDocRef.set(petState, { merge: true })
  .then(() => {
  console.log("Nuevo juego inicializado en Firebase");
  addEventToBar("ğŸ†• Nuevo juego iniciado", "Â¡Bienvenido a tu nueva aventura con Cakiwaki!");
  updateUI();
  })
  .catch((error) => {
  console.error("Error al inicializar el juego en Firebase:", error);
  addEventToBar("ğŸš¨ Error al iniciar el juego.", "Ha ocurrido un problema al iniciar tu partida. Por favor, intÃ©ntalo de nuevo mÃ¡s tarde.");
  });
  }
  
  function loadGame() {
  petDocRef.onSnapshot((doc) => {
  if (doc.exists) {
  const data = doc.data();
  petState = data;
  updateUI();
  if (petState.isDead) {
  addEventToBar(getRandomPhrase('dead'), "ğŸ’€ Cakiwaki ha muerto. RevÃ­velo con comida.");
  deathOverlay.classList.add('active');
  } else {
  addEventToBar("ğŸ® Juego cargado", "Â¡Bienvenido de nuevo! Cakiwaki estÃ¡ feliz de verte.");
  deathOverlay.classList.remove('active');
  }
  } else {
  initializeNewGame();
  }
  }, (error) => {
  console.error("Error al cargar el juego desde Firebase:", error);
  addEventToBar("ğŸš¨ Error al cargar el juego.", "Ha ocurrido un problema al cargar tu progreso. Por favor, intÃ©ntalo de nuevo mÃ¡s tarde.");
  });
  }
  
  function updateUI() {
  updateStatus();
  updateChestItems();
  setInitialBackground();
  lightSwitch.textContent = petState.isLightOn ? 'ğŸ’¡' : 'ğŸŒ™';
  crown.textContent = petState.accessories.crown;
  glasses.textContent = petState.accessories.glasses;
  hat.textContent = petState.accessories.hat;
  changeExpression(petState.expression);
  handleGlobalDeath();
  }
  
  function petDeath() {
  petState.isDead = true;
  changeExpression(Math.random() < 0.5 ? 'ğŸ’€' : 'ğŸ‘¹');
  pet.style.fontSize = '15vh';
  addEventToBar(getRandomPhrase('dead'), "ğŸ’€ Cakiwaki ha muerto. RevÃ­velo con comida.");
  updateFirestore();
  handleGlobalDeath();
  }
  
  function handleGlobalDeath() {
  if (petState.isDead) {
  document.body.style.opacity = '0.5';
  addEventToBar("â˜ ï¸ Cakiwaki ha muerto para todos.", "Todos los jugadores han perdido a su mascota. Alimenta a Cakiwaki para revivirlo.");
  deathOverlay.classList.add('active');
  } else {
  document.body.style.opacity = '1';
  deathOverlay.classList.remove('active');
  }
  }
  
  function randomEvent() {
  if (petState.isDead) return;
  
  const events = [
  { probability: 0.05, action: () => { addEventToBar("ğŸŒŸ Â¡Cakiwaki encontrÃ³ una moneda brillante!", "Â¡QuÃ© suerte! Cada moneda ayuda a cuidar mejor a Cakiwaki."); petState.currency += 10; gainXP(5); } },
  { probability: 0.03, action: () => { addEventToBar(getRandomPhrase('random'), "Cakiwaki tiene ideas interesantes. Â¿Por quÃ© no juegas con Ã©l?"); } },
  { probability: 0.04, action: () => { addEventToBar("ğŸ Â¡Regalo sorpresa para Cakiwaki!", "Â¡QuÃ© emociÃ³n! Jugar minijuegos ayuda a Cakiwaki a divertirse y ganar recompensas."); petState.xp += 20; gainXP(20); } },
  { probability: 0.02, action: () => { addEventToBar("ğŸ€ Â¡DÃ­a de suerte para Cakiwaki!", "La buena suerte sonrÃ­e a Cakiwaki hoy. Â¡Aprovecha este momento especial!"); petState.fun = Math.min(100, petState.fun + 15); gainXP(5); } },
  { probability: 0.01, action: () => { addEventToBar("ğŸ“š Cakiwaki aprendiÃ³ algo nuevo", "Â¡IncreÃ­ble! Cakiwaki estÃ¡ creciendo y aprendiendo. Sigue enseÃ±Ã¡ndole cosas nuevas."); gainXP(15); } },
  { probability: 0.02, action: () => { addEventToBar("ğŸŒˆ Un arcoÃ­ris apareciÃ³ en el cielo", "Los arcoÃ­ris traen alegrÃ­a y fortuna. Â¡Disfruta este momento mÃ¡gico con Cakiwaki!"); petState.currency += 30; gainXP(10); } },
  { probability: 0.01, action: () => { addEventToBar("ğŸˆ Cakiwaki encontrÃ³ un globo", "Â¡QuÃ© divertido! Los globos siempre alegran el dÃ­a de Cakiwaki."); petState.fun = Math.min(100, petState.fun + 20); gainXP(5); } }
  ];
  
  events.forEach(event => {
  if (Math.random() < event.probability) {
  event.action();
  updateFirestore();
  }
  });
  }
  
  function petRandomMessage() {
  if (petState.isDead || !petState.isLightOn) return;
  addEventToBar(getRandomPhrase('random'), "Cakiwaki tiene mucho que decir. Â¡Presta atenciÃ³n a sus ocurrencias!");
  updateFirestore();
  }
  
  function optimizePerformance() {
  function animate() {
  if (!petState.isDead) {
  movePet();
  }
  requestAnimationFrame(animate);
  }
  requestAnimationFrame(animate);
  
  let firebaseUpdateTimeout;
  function throttledFirebaseUpdate() {
  if (!firebaseUpdateTimeout) {
  firebaseUpdateTimeout = setTimeout(() => {
  updateFirestore();
  firebaseUpdateTimeout = null;
  }, 5000);
  }
  }
  
  window.updateFirestore = throttledFirebaseUpdate;
  }
  
  function manageMemory() {
  setInterval(() => {
  const poops = document.querySelectorAll('.poop');
  if (poops.length > 6) {
  poops[0].remove();
  addEventToBar("ğŸ§¹ Limpieza automÃ¡tica", "El entorno de Cakiwaki se mantiene limpio automÃ¡ticamente para evitar problemas de salud.");
  petState.hygiene = Math.max(0, petState.hygiene - 10);
  updateFirestore();
  }
  }, 60000);
  
  const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
  if (mutation.type === 'childList') {
  while (eventBar.childNodes.length > 5) {
  eventBar.removeChild(eventBar.lastChild);
  }
  }
  });
  });
  
  observer.observe(eventBar, { childList: true });
  }
  
  function dailyReward() {
  const lastRewardDate = localStorage.getItem('lastRewardDate');
  const today = new Date().toDateString();
  
  if (lastRewardDate !== today) {
  const rewardAmount = 100 + (petState.level * 10);
  petState.currency += rewardAmount;
  addEventToBar(`ğŸ Â¡Recompensa diaria! +${rewardAmount} monedas`, "Â¡Vuelve maÃ±ana para otra recompensa! Jugar regularmente ayuda a Cakiwaki a crecer mÃ¡s rÃ¡pido.");
  localStorage.setItem('lastRewardDate', today);
  updateFirestore();
  }
  }
  
  function achievementSystem() {
  const achievements = [
  { id: 'level10', name: 'Mascota Adolescente', condition: () => petState.level >= 10, reward: 500 },
  { id: 'level20', name: 'Mascota Adulta', condition: () => petState.level >= 20, reward: 1000 },
  { id: 'rich', name: 'Rico y Famoso', condition: () => petState.currency >= 10000, reward: 2000 },
  { id: 'collector', name: 'Coleccionista', condition: () => petState.chestItems.length >= 10, reward: 1500 }
  ];
  
  achievements.forEach(achievement => {
  if (achievement.condition() && !localStorage.getItem(`achievement_${achievement.id}`)) {
  petState.currency += achievement.reward;
  addEventToBar(`ğŸ† Logro desbloqueado: ${achievement.name}. +${achievement.reward} monedas`, "Â¡FantÃ¡stico! Los logros demuestran tu dedicaciÃ³n como cuidador de mascotas virtuales.");
  localStorage.setItem(`achievement_${achievement.id}`, 'true');
  updateFirestore();
  }
  });
  }
  
  function specialEvents() {
  const events = [
  { name: 'Lluvia de Meteoritos', probability: 0.01, action: () => {
  addEventToBar('â˜„ï¸ Â¡Lluvia de meteoritos! Cakiwaki estÃ¡ emocionado.', "Un evento raro y emocionante. Â¡DisfrÃºtalo con Cakiwaki!");
  petState.fun = Math.min(100, petState.fun + 30);
  gainXP(50);
  updateFirestore();
  }},
  { name: 'Visita del Hada Madrina', probability: 0.005, action: () => {
  addEventToBar('ğŸ§šâ€â™€ï¸ El Hada Madrina visitÃ³ a Cakiwaki y le concediÃ³ un deseo.', "Â¡QuÃ© suerte! El Hada Madrina trae magia y buenos deseos.");
  const randomStat = Math.floor(Math.random() * 3);
  switch(randomStat) {
  case 0:
  petState.hunger = 100;
  addEventToBar('ğŸ½ï¸ Â¡Cakiwaki estÃ¡ completamente satisfecho!', "El Hada Madrina llenÃ³ mÃ¡gicamente el estÃ³mago de Cakiwaki.");
  break;
  case 1:
  petState.fun = 100;
  addEventToBar('ğŸ‰ Â¡Cakiwaki estÃ¡ extremadamente feliz!', "El Hada Madrina trajo mucha diversiÃ³n a Cakiwaki.");
  break;
  case 2:
  petState.hygiene = 100;
  addEventToBar('âœ¨ Â¡Cakiwaki estÃ¡ impecablemente limpio!', "El Hada Madrina dio un baÃ±o mÃ¡gico a Cakiwaki.");
  break;
  }
  updateFirestore();
  }},
  { name: 'InvasiÃ³n AlienÃ­gena', probability: 0.002, action: () => {
  addEventToBar('ğŸ‘½ Â¡Una invasiÃ³n alienÃ­gena! Cakiwaki estÃ¡ fascinado.', "Â¡IncreÃ­ble! Los alienÃ­genas trajeron tecnologÃ­a avanzada y diversiÃ³n.");
  gainXP(100);
  petState.currency += 500;
  updateFirestore();
  }}
  ];
  
  events.forEach(event => {
  if (Math.random() < event.probability) {
  event.action();
  }
  });
  }
  
  function seasonalEvents() {
  const now = new Date();
  const month = now.getMonth();
  const day = now.getDate();
  
  if (month === 11 && day === 25) { // Navidad
  addEventToBar("ğŸ„ Â¡Feliz Navidad!", "Cakiwaki ha recibido un regalo especial.");
  petState.currency += 1000;
  petState.chestItems.push('ğŸ');
  } else if (month === 0 && day === 1) { // AÃ±o Nuevo
  addEventToBar("ğŸ† Â¡Feliz AÃ±o Nuevo!", "Cakiwaki estÃ¡ emocionado por un nuevo aÃ±o de aventuras.");
  gainXP(500);
  } else if (month === 9 && day === 31) { // Halloween
  addEventToBar("ğŸƒ Â¡Feliz Halloween!", "Cakiwaki se ha disfrazado para la ocasiÃ³n.");
  petState.chestItems.push('ğŸ‘»');
  }
  
  updateFirestore();
  }
  
  function handleSwipe() {
  const petFrame = document.querySelector('.pet-frame');
  
  petFrame.addEventListener('touchstart', (e) => {
  touchStartX = e.changedTouches[0].screenX;
  }, false);
  
  petFrame.addEventListener('touchend', (e) => {
  touchEndX = e.changedTouches[0].screenX;
  handleGesture();
  }, false);
  
  function handleGesture() {
  const swipeDistance = touchEndX - touchStartX;
  if (Math.abs(swipeDistance) > swipeThreshold) {
  if (swipeDistance > 0) {
  // Swipe a la derecha
  petState.currentBackground = (petState.currentBackground % totalBackgrounds) + 1;
  } else {
  // Swipe a la izquierda
  petState.currentBackground = (petState.currentBackground - 2 + totalBackgrounds) % totalBackgrounds + 1;
  }
  background.className = `background ${backgrounds[petState.currentBackground - 1]}`;
  addEventToBar("ğŸ¨ Â¡Fondo cambiado!", "Has cambiado el fondo de Cakiwaki.");
  updateFirestore();
  }
  }
  }
  
  function generatePoop() {
  if (petState.isDead) return;
  const poops = document.querySelectorAll('.poop');
  if (poops.length >= 6) return;
  
  const poop = document.createElement('div');
  poop.classList.add('poop');
  poop.textContent = 'ğŸ’©';
  const petFrame = document.querySelector('.pet-frame');
  
  let x, y;
  do {
  x = Math.random() * (petFrame.offsetWidth - 30);
  y = Math.random() * (petFrame.offsetHeight - 30);
  } while (
  x > petFrame.offsetWidth / 2 - 50 && x < petFrame.offsetWidth / 2 + 50 &&
  y > petFrame.offsetHeight / 2 - 50 && y < petFrame.offsetHeight / 2 + 50
  );
  
  poop.style.left = `${x}px`;
  poop.style.top = `${y}px`;
  petFrame.appendChild(poop);
  
  poop.addEventListener('click', () => {
  poop.remove();
  petState.hygiene = Math.max(0, petState.hygiene - 10);
  addEventToBar("ğŸ§¹ Has limpiado una caca", "Mantener limpio el ambiente de Cakiwaki es importante para su salud.");
  updateFirestore();
  });
  
  petState.hygiene = Math.max(0, petState.hygiene - 5);
  updateFirestore();
  }
  
  function movePet() {
  if (petState.isDead) return;
  
  const oscillationRange = 5;
  const oscillationSpeed = 0.005;
  const oscillationX = oscillationRange * Math.sin(Date.now() * oscillationSpeed);
  const oscillationY = oscillationRange * Math.cos(Date.now() * oscillationSpeed);
  
  petContainer.style.left = `calc(50% + ${oscillationX}px)`;
  petContainer.style.top = `calc(50% + ${oscillationY}px)`;
  petContainer.style.transform = 'translate(-50%, -50%)';
  }
  
  function resizePet() {
  const size = 5 + (petState.hunger / 100) * 25;
  pet.style.fontSize = `${size}vh`;
  }
  
  function toggleCyclingExpressions() {
  if (!isCyclingExpression) {
  isCyclingExpression = true;
  expressionInterval = setInterval(() => {
  currentpetEmojiIndex = (currentpetEmojiIndex + 1) % petEmojis.length;
  changeExpression(petEmojis[currentpetEmojiIndex]);
  }, 1000);
  addEventToBar("ğŸ”„ Ciclo de expresiones iniciado", "Cakiwaki estÃ¡ mostrando diferentes expresiones.");
  } else {
  isCyclingExpression = false;
  clearInterval(expressionInterval);
  changePetFace();
  addEventToBar("ğŸ”„ Ciclo de expresiones detenido", "Cakiwaki ha vuelto a su expresiÃ³n habitual.");
  }
  updateFirestore();
  }
  
  function init() {
  loadGame();
  setInitialBackground();
  setInterval(decreaseStats, 2000);
  setInterval(changeWeather, 15000);
  setInterval(randomEvent, 60000);
  setInterval(petRandomMessage, 90000);
  setInterval(generatePoop, Math.floor(Math.random() * 50000) + 20000);
  setInterval(specialEvents, 300000);
  setInterval(seasonalEvents, 86400000);
  optimizePerformance();
  manageMemory();
  dailyReward();
  achievementSystem();
  handleSwipe();
  }
  
  function setInitialBackground() {
  background.className = `background ${backgrounds[petState.currentBackground - 1]}`;
  }
  
  function updatePetAppearance() {
  if (petState.level >= 20) {
  pet.style.filter = 'drop-shadow(0 0 15px gold)';
  } else if (petState.level >= 10) {
  pet.style.filter = 'drop-shadow(0 0 10px silver)';
  } else if (petState.level >= 5) {
  pet.style.filter = 'drop-shadow(0 0 5px bronze)';
  } else {
  pet.style.filter = 'none';
  }
  }
  
  function changePetFace() {
  if (!petState.isSick && petState.isLightOn) {
  currentpetEmojiIndex = Math.floor(Math.random() * petEmojis.length);
  changeExpression(petEmojis[currentpetEmojiIndex]);
  }
  }
  
  function resizeContent() {
  const gameContainer = document.querySelector('.game-container');
  const height = window.innerHeight;
  gameContainer.style.height = `${height}px`;
  }
  
  function applyBlurEffect() {
  const gameContainer = document.querySelector('.game-container');
  if (!petState.isLightOn) {
  gameContainer.classList.add('blurred');
  } else {
  gameContainer.classList.remove('blurred');
  }
  }
  
  // Event listeners
  window.addEventListener('resize', resizeContent);
  
  document.addEventListener('DOMContentLoaded', () => {
  init();
  resizeContent();
  });
  
  // Cerrar modales al hacer clic en la "x"
  const closeButtons = document.querySelectorAll('.close');
  closeButtons.forEach(button => {
  button.addEventListener('click', () => {
  button.parentElement.parentElement.style.display = 'none';
  });
  });
  
  // Cerrar modales al hacer clic fuera del contenido
  window.addEventListener('click', (e) => {
  if (e.target == shopModal) {
  shopModal.style.display = 'none';
  }
  if (e.target == foodModal) {
  foodModal.style.display = 'none';
  }
  if (e.target == miniGameModal) {
  miniGameModal.style.display = 'none';
  }
  if (e.target == chestModal) {
  chestModal.style.display = 'none';
  }
  });
  
  // FunciÃ³n para enfermedad aleatoria
  function randomSickness() {
  if (!petState.isSick && Math.random() < 0.01) {
  petState.isSick = true;
  addEventToBar(getRandomPhrase('sick'), "Cakiwaki nose siente bien. Considera darle medicina.");
  updateFirestore();
  }
  }
  
  // FunciÃ³n para aplicar el efecto de desenfoque
  function applyBlurEffect() {
  const gameContainer = document.querySelector('.game-container');
  if (!petState.isLightOn) {
  gameContainer.classList.add('blurred');
  } else {
  gameContainer.classList.remove('blurred');
  }
  }
  
  // FunciÃ³n para actualizar el fondo
  function updateBackground() {
  background.className = `background ${backgrounds[petState.currentBackground - 1]}`;
  }
  
  // Evento para cambiar el fondo con las teclas de flecha
  document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft') {
  petState.currentBackground = ((petState.currentBackground - 2 + totalBackgrounds) % totalBackgrounds) + 1;
  updateBackground();
  addEventToBar("ğŸ¨ Â¡Fondo cambiado!", "Has cambiado el fondo de Cakiwaki con la flecha izquierda.");
  updateFirestore();
  } else if (e.key === 'ArrowRight') {
  petState.currentBackground = (petState.currentBackground % totalBackgrounds) + 1;
  updateBackground();
  addEventToBar("ğŸ¨ Â¡Fondo cambiado!", "Has cambiado el fondo de Cakiwaki con la flecha derecha.");
  updateFirestore();
  }
  });
  
  // FunciÃ³n para manejar el bonus por caricia
  function handleCaressBonus() {
  petState.caressCount++;
  if (petState.caressCount % 5 === 0) {
  const bonusAmount = 10 + Math.floor(petState.level / 2);
  petState.currency += bonusAmount;
  addEventToBar(`ğŸ’– Â¡Bonus por caricias! +${bonusAmount} monedas`, "Cakiwaki aprecia tus caricias constantes.");
  showCaressBonusNotification();
  updateFirestore();
  }
  }
  
  // FunciÃ³n para mostrar la notificaciÃ³n de bonus por caricia
  function showCaressBonusNotification() {
  caressBonus.style.display = 'block';
  setTimeout(() => {
  caressBonus.style.display = 'none';
  }, 3000);
  }
  
  // Actualizar el evento de clic en la mascota
  pet.addEventListener('click', () => {
  if (petState.isDead || !petState.isLightOn) return;
  
  toggleCyclingExpressions();
  handleCaressBonus();
  });
  
  // FunciÃ³n para manejar la muerte y resurrecciÃ³n
  function handleDeathAndResurrection() {
  if (petState.isDead) {
  deathOverlay.classList.add('active');
  document.body.classList.add('pet-dead');
  } else {
  deathOverlay.classList.remove('active');
  document.body.classList.remove('pet-dead');
  }
  applyBlurEffect();
  }
  
  // Actualizar la funciÃ³n feedPet para manejar la resurrecciÃ³n
  function feedPet(food) {
  if (petState.currency >= food.price && petState.level >= food.requiredLevel) {
  petState.currency -= food.price;
  if (petState.isDead) {
  petState.isDead = false;
  petState.hunger = 50;
  petState.fun = 50;
  petState.hygiene = 50;
  petState.level = 1;
  petState.xp = 0;
  addEventToBar("ğŸ‰ Cakiwaki ha revivido!", "Â¡IncreÃ­ble! Has traÃ­do a Cakiwaki de vuelta. CuÃ­dalo bien esta vez.");
  handleDeathAndResurrection();
  } else {
  petState.hunger = Math.min(100, petState.hunger + food.hunger);
  }
  addEventToBar(getRandomPhrase('feed'), "Alimentar a Cakiwaki regularmente lo mantendrÃ¡ feliz y saludable.");
  gainXP(5);
  if (petState.hunger > 100) {
  petState.isSick = true;
  addEventToBar("ğŸ¤¢ Cakiwaki comiÃ³ demasiado", "Â¡Uh oh! Parece que Cakiwaki se excediÃ³. Un poco de descanso lo ayudarÃ¡ a sentirse mejor.");
  }
  updateFirestore();
  foodModal.style.display = 'none';
  } else if (petState.level < food.requiredLevel) {
  addEventToBar(`âŒ Necesitas nivel ${food.requiredLevel}`, "Sigue jugando y cuidando a Cakiwaki para desbloquear mÃ¡s opciones de comida.");
  } else {
  addEventToBar("ğŸ’°âŒ No tienes suficientes monedas", "Â¡No te desanimes! Juega minijuegos o completa logros para ganar mÃ¡s monedas.");
  }
  }
  
  // Actualizar la funciÃ³n updateUI para incluir el manejo de muerte y resurrecciÃ³n
  function updateUI() {
  updateStatus();
  updateChestItems();
  setInitialBackground();
  lightSwitch.textContent = petState.isLightOn ? 'ğŸ’¡' : 'ğŸŒ™';
  crown.textContent = petState.accessories.crown;
  glasses.textContent = petState.accessories.glasses;
  hat.textContent = petState.accessories.hat;
  changeExpression(petState.expression);
  handleDeathAndResurrection();
  }
  
  // InicializaciÃ³n del juego
  init();
    </script>
</body>
</html>