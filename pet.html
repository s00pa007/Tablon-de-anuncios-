<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¾ Neonpet Deluxe ğŸ¾</title>
    <style>
    :root {
    --primary-gradient: linear-gradient(45deg, #ff00ff, #00ffff);
    --secondary-gradient: linear-gradient(45deg, #ff8a00, #e52e71);
    --neon-blue: #00ffff;
    --neon-pink: #ff00ff;
    --neon-yellow: #ffff00;
    --neon-green: #39ff14;
    --background-color: #1a0b2e;
    }
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    user-select: none;
    }
    body {
    font-family: 'Arial', sans-serif;
    background-color: var(--background-color);
    color: white;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    }
    .game-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 10px;
    position: relative;
    overflow: hidden;
    min-height: 100vh;
    }
    .frame {
    border: 2px solid var(--neon-blue);
    border-radius: 20px;
    padding: 10px;
    margin-bottom: 10px;
    box-shadow: 0 0 10px var(--neon-blue);
    }
    .info-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    flex-wrap: wrap;
    }
    .currency, .xp, .weather {
    font-size: 1.2em;
    font-weight: bold;
    color: var(--neon-yellow);
    text-shadow: 0 0 5px var(--neon-yellow);
    margin: 5px 0;
    }
    .status-bars {
    display: flex;
    justify-content: space-around;
    margin-bottom: 10px;
    flex-wrap: wrap;
    }
    .status-bar {
    width: 30%;
    min-width: 80px;
    text-align: center;
    }
    .bar-container {
    height: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    margin-bottom: 5px;
    }
    .status-fill {
    height: 100%;
    transition: width 0.3s ease;
    }
    #hunger-fill { background: var(--primary-gradient); }
    #fun-fill { background: var(--secondary-gradient); }
    #hygiene-fill { background: linear-gradient(45deg, #4facfe, #00f2fe); }
    .status-emoji {
    font-size: 1.5em;
    }
    .display-container {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    }
    .display-left, .display-right {
    width: 48%;
    border: 2px solid var(--neon-blue);
    border-radius: 10px;
    padding: 5px;
    height: 70px;
    overflow-y: auto;
    }
    .display-right {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    }
    .event-icon {
    font-size: 0.9em;
    margin-bottom: 5px;
    color: var(--neon-yellow);
    text-shadow: 0 0 5px var(--neon-yellow);
    opacity: 1;
    transition: opacity 0.5s ease;
    }
    .pet-frame {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    overflow: hidden;
    margin-bottom: 10px;
    }
    .pet-container {
    position: absolute;
    width: 30vh;
    height: 30vh;
    transition: transform 0.5s ease;
    }
    .pet {
    font-size: 15vh;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    filter: drop-shadow(0 0 5px var(--neon-yellow));
    user-select: none;
    transition: all 0.5s ease;
    cursor: pointer;
    z-index: 10;
    }
    .pet-accessory {
    position: absolute;
    font-size: 10vh;
    z-index: 11;
    cursor: move;
    transition: all 0.5s ease;
    }
    .accessory-crown { top: -5vh; left: 50%; transform: translateX(-50%); }
    .accessory-glasses { top: 4vh; left: 50%; transform: translateX(-50%); font-size: 11vh; }
    .accessory-hat { top: -5.5vh; left: 50%; transform: translateX(-50%); }
    .action-buttons {
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
    position: sticky;
    bottom: 0;
    background-color: var(--background-color);
    }
    .action-btn {
    font-size: 2em;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid var(--neon-blue);
    border-radius: 10px;
    padding: 10px;
    color: white;
    text-shadow: 0 0 5px var(--neon-blue);
    transition: transform 0.2s ease;
    margin: 5px;
    flex: 1 1 80px;
    max-width: 100px;
    text-align: center;
    cursor: pointer;
    }
    .action-btn:active {
    transform: scale(0.9);
    }
    .modal {
    display: none;
    position: fixed;
    z-index: 20;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow-y: auto;
    background-color: rgba(0,0,0,0.8);
    }
    .modal-content {
    background: var(--background-color);
    margin: 10% auto;
    padding: 20px;
    border: 2px solid var(--neon-blue);
    width: 90%;
    max-height: 80%;
    overflow-y: auto;
    border-radius: 20px;
    box-shadow: 0 0 15px var(--neon-blue);
    position: relative;
    }
    .close, .close-chest {
    color: var(--neon-pink);
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 1.5em;
    font-weight: bold;
    cursor: pointer;
    }
    .close:hover, .close-chest:hover,
    .close:focus, .close-chest:focus {
    color: var(--neon-yellow);
    text-decoration: none;
    }
    .chest-modal {
    display: none;
    position: fixed;
    z-index: 20;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow-y: auto;
    background-color: rgba(0,0,0,0.7);
    }
    .chest-content {
    background-color: var(--background-color);
    margin: 15% auto;
    padding: 20px;
    border: 2px solid var(--neon-blue);
    width: 80%;
    max-width: 300px;
    border-radius: 10px;
    position: relative;
    }
    .chest-item {
    display: inline-block;
    font-size: 1.5em;
    margin: 5px;
    cursor: pointer;
    }
    .shop-items, .food-items {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 10px;
    margin-top: 20px;
    }
    .shop-item, .food-item {
    font-size: 1.2em;
    text-align: center;
    padding: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    cursor: pointer;
    transition: transform 0.2s ease;
    }
    .shop-item:active, .food-item:active {
    transform: scale(0.95);
    }
    .mini-game-board {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(4, 1fr);
    gap: 5px;
    width: 200px;
    height: 200px;
    margin: 20px auto;
    }
    .mini-game-cell {
    width: 100%;
    height: 100%;
    background-color: var(--neon-blue);
    border-radius: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.5em;
    cursor: pointer;
    transition: transform 0.3s ease;
    }
    .mini-game-cell:active {
    transform: scale(0.95);
    }
    .chest, .shop-icon {
    font-size: 2em;
    cursor: pointer;
    margin: 0 15px;
    }
    .light-switch {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 1.5em;
    cursor: pointer;
    z-index: 12;
    }
    .poop {
    position: absolute;
    font-size: 3em;
    cursor: pointer;
    z-index: 9;
    }
    .background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    transition: opacity 1s ease;
    }
    .grid-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(4, 1fr);
    z-index: 1;
    }
    .grid-cell {
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-sizing: border-box;
    }
    @media (max-width: 600px) {
    .currency, .xp, .weather {
    font-size: 1em;
    }
    .action-btn {
    font-size: 1.5em;
    padding: 8px;
    max-width: 80px;
    }
    .pet {
    font-size: 12vh;
    }
    .pet-container {
    width: 25vh;
    height: 25vh;
    }
    .event-icon {
    font-size: 0.8em;
    }
    .action-buttons {
    justify-content: center;
    }
    .action-btn {
    flex: 1 1 70px;
    margin: 5px;
    }
    .close, .close-chest {
    font-size: 1.2em;
    }
    }
    </style>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    </head>
    <body>
    <div class="game-container">
        <div class="frame info-bar">
            <div class="currency" id="currency">ğŸ’° 2000</div>
            <div class="xp" id="xp">â­ 0</div>
            <div class="weather" id="weather">â˜€ï¸</div>
        </div>
        <div class="frame status-bars">
            <div class="status-bar">
                <div class="bar-container"><div id="hunger-fill" class="status-fill"></div></div>
                <div class="status-emoji">ğŸ”</div>
            </div>
            <div class="status-bar">
                <div class="bar-container"><div id="fun-fill" class="status-fill"></div></div>
                <div class="status-emoji">ğŸ‰</div>
            </div>
            <div class="status-bar">
                <div class="bar-container"><div id="hygiene-fill" class="status-fill"></div></div>
                <div class="status-emoji">ğŸš¿</div>
            </div>
        </div>
        <div class="display-container">
            <div class="display-left" id="eventBar"></div>
            <div class="display-right">
                <div class="shop-icon" id="shopIcon">ğŸª</div>
                <div class="chest" id="chest">ğŸ“¦</div>
            </div>
        </div>
        <div class="frame pet-frame">
            <div class="background" id="background"></div>
            <div class="grid-container" id="gridContainer"></div>
            <div class="pet-container">
                <div class="pet" id="pet">ğŸ˜Š</div>
                <div id="crown" class="pet-accessory accessory-crown" draggable="true"></div>
                <div id="glasses" class="pet-accessory accessory-glasses" draggable="true"></div>
                <div id="hat" class="pet-accessory accessory-hat" draggable="true"></div>
            </div>
            <div class="light-switch" id="lightSwitch">ğŸ’¡</div>
        </div>
        <div class="action-buttons">
            <button class="action-btn" id="feed-btn">ğŸ½ï¸</button>
            <button class="action-btn" id="play-btn">ğŸ®</button>
            <button class="action-btn" id="clean-btn">ğŸ§¼</button>
            <button class="action-btn" id="shop-btn">ğŸ›ï¸</button>
        </div>
    </div>
    
    <!-- Modales -->
    <div id="shopModal" class="modal">
        <div class="modal-content">
            <span class="close">âŒ</span>
            <h2>ğŸ›ï¸ Tienda</h2>
            <div class="shop-items" id="shop-items"></div>
        </div>
    </div>
    
    <div id="foodModal" class="modal">
        <div class="modal-content">
            <span class="close">âŒ</span>
            <h2>ğŸ½ï¸ Comida</h2>
            <div class="food-items" id="food-items"></div>
        </div>
    </div>
    
    <div id="miniGameModal" class="modal">
        <div class="modal-content">
            <span class="close">âŒ</span>
            <h2>ğŸ® Minijuego</h2>
            <div id="mini-game-board" class="mini-game-board"></div>
        </div>
    </div>
    
    <div id="chestModal" class="chest-modal">
        <div class="chest-content">
            <span class="close-chest" id="closeChest">âŒ</span>
            <h2>ğŸ“¦ Cofre</h2>
            <div id="chestItems"></div>
        </div>
    </div>
    <script>
    // ConfiguraciÃ³n de Firebase
    const firebaseConfig = {
    apiKey: "AIzaSyBlIRJVI1buU48SPp0ErpCXhnuBdBEp8rk",
    authDomain: "tablon-de-anuncios-d5dea.firebaseapp.com",
    projectId: "tablon-de-anuncios-d5dea",
    storageBucket: "tablon-de-anuncios-d5dea.appspot.com",
    messagingSenderId: "67910184237",
    appId: "1:67910184237:web:e43d424657a948ae5d77a4",
    measurementId: "G-YL5W1VNM9Z"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const database = firebase.database();
    
    // Referencia del documento
    const petDocRef = db.collection('pet').doc('status');
    
    // Variables globales
    let hunger = 100;
    let fun = 100;
    let hygiene = 100;
    let currency = 2000;
    let xp = 0;
    let level = 1;
    let isSick = false;
    let caressCount = 0;
    let chestItems = [];
    let shampooCount = 0;
    let isLightOn = true;
    let currentBackground = 0;
    let poopInterval;
    let isGameActive = true;
    let lastExpressionChangeTime = 0;
    let tapCount = 0;
    let expressionTimeout;
    let lastUserInteractionTime = 0;
    
    // Elementos del DOM
    const pet = document.getElementById('pet');
    const petContainer = document.querySelector('.pet-container');
    const crown = document.getElementById('crown');
    const glasses = document.getElementById('glasses');
    const hat = document.getElementById('hat');
    const hungerFill = document.getElementById('hunger-fill');
    const funFill = document.getElementById('fun-fill');
    const hygieneFill = document.getElementById('hygiene-fill');
    const currencyElement = document.getElementById('currency');
    const xpElement = document.getElementById('xp');
    const weatherElement = document.getElementById('weather');
    const eventBar = document.getElementById('eventBar');
    const chest = document.getElementById('chest');
    const shopIcon = document.getElementById('shopIcon');
    const lightSwitch = document.getElementById('lightSwitch');
    const background = document.getElementById('background');
    
    const feedBtn = document.getElementById('feed-btn');
    const playBtn = document.getElementById('play-btn');
    const cleanBtn = document.getElementById('clean-btn');
    
    const shopModal = document.getElementById('shopModal');
    const foodModal = document.getElementById('foodModal');
    const miniGameModal = document.getElementById('miniGameModal');
    const chestModal = document.getElementById('chestModal');
    const chestItemsContainer = document.getElementById('chestItems');
    const closeChest = document.getElementById('closeChest');
    
    const petEmojis = ['ğŸ˜Š', 'ğŸ˜„', 'ğŸ˜', 'ğŸ¤”', 'ğŸ˜´', 'ğŸ˜‹', 'ğŸ˜', 'ğŸ¤“', 'ğŸ¥³', 'ğŸ˜', 'ğŸ¤ª', 'ğŸ˜‡', 'ğŸ¥°', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ˜³', 'ğŸ™„', 'ğŸ˜¬', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜­', 'ğŸ˜±', 'ğŸ¤¯', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜“', 'ğŸ¤—', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤¥', 'ğŸ˜¶', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¬', 'ğŸ™„', 'ğŸ˜¯', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜®', 'ğŸ˜²', 'ğŸ¥±', 'ğŸ˜´', 'ğŸ¤¤', 'ğŸ˜ª', 'ğŸ˜µ'];
    const weatherEmojis = ['â˜€ï¸', 'ğŸŒ§ï¸', 'â„ï¸', 'ğŸŒ¤ï¸', 'ğŸŒˆ'];
    let currentpetEmojiIndex = 0;
    let currentWeatherIndex = 0;
    
    const shopItems = [
    { emoji: 'ğŸ‘‘', price: 500, type: 'crown', requiredLevel: 5 },
    { emoji: 'ğŸ‘“', price: 300, type: 'glasses', requiredLevel: 3 },
    { emoji: 'ğŸ§¢', price: 200, type: 'hat', requiredLevel: 2 },
    { emoji: 'ğŸ©', price: 1000, type: 'topHat', requiredLevel: 10 },
    { emoji: 'ğŸ§´', price: 50, type: 'shampoo', requiredLevel: 1 },
    { emoji: 'ğŸ’Š', price: 100, type: 'medicine', requiredLevel: 1 }
    ];
    
    const foodItems = [
    { emoji: 'ğŸ', hunger: 10, price: 50, requiredLevel: 1 },
    { emoji: 'ğŸ”', hunger: 25, price: 100, requiredLevel: 2 },
    { emoji: 'ğŸ•', hunger: 20, price: 150, requiredLevel: 3 },
    { emoji: 'ğŸ¦', hunger: 5, price: 80, requiredLevel: 1 },
    { emoji: 'ğŸ¥—', hunger: 15, price: 120, requiredLevel: 2 },
    { emoji: 'ğŸ±', hunger: 30, price: 200, requiredLevel: 4 }
    ];
    
    const backgrounds = [
    'linear-gradient(to bottom, #87CEEB, #E0F6FF)',
    'linear-gradient(to bottom, #FF7F50, #FFB6C1)',
    'linear-gradient(to bottom, #191970, #000000)'
    ];
    
    // Frases variadas para la interfaz
    const phrases = {
    feed: [
    "Â¡QuÃ© rico! ğŸ˜‹",
    "Â¡Gracias por la comida! ğŸ½ï¸",
    "Â¡Estaba delicioso! ğŸ¤¤",
    "Â¡Justo lo que necesitaba! ğŸ´",
    "Â¡Mmm, mi favorito! ğŸ˜",
    "Â¡Cakiwaki estÃ¡ satisfecho! ğŸ¥°",
    "Â¡EnergÃ­a renovada! ğŸ’ª",
    "Â¡Cakiwaki dice gracias! ğŸ™"
    ],
    play: [
    "Â¡QuÃ© divertido! ğŸ‰",
    "Â¡Me encanta jugar contigo! ğŸ¥³",
    "Â¡Eres el mejor compaÃ±ero de juegos! ğŸ®",
    "Â¡Otra vez, otra vez! ğŸ”„",
    "Â¡Esto es genial! ğŸ¤©",
    "Â¡Cakiwaki estÃ¡ muy feliz! ğŸ˜„",
    "Â¡DiversiÃ³n al mÃ¡ximo! ğŸˆ",
    "Â¡Cakiwaki quiere mÃ¡s juegos! ğŸ•¹ï¸"
    ],
    clean: [
    "Â¡QuÃ© fresquito! ğŸ§¼",
    "Â¡Gracias por el baÃ±o! ğŸš¿",
    "Â¡Me siento como nuevo! âœ¨",
    "Â¡AdiÃ³s, suciedad! ğŸ‘‹",
    "Â¡Ahora estoy reluciente! ğŸ’",
    "Â¡Cakiwaki estÃ¡ limpio y feliz! ğŸ§½",
    "Â¡QuÃ© bien huele Cakiwaki! ğŸŒ¸",
    "Â¡BaÃ±o refrescante para Cakiwaki! ğŸ›"
    ],
    caress: [
    "Â¡Me encantan tus caricias! ğŸ’–",
    "Â¡QuÃ© agradable! ğŸ˜Š",
    "Â¡MÃ¡s, por favor! ğŸ¥°",
    "Â¡Eres el mejor! ğŸŒŸ",
    "Â¡Me haces tan feliz! ğŸ˜„",
    "Â¡Cakiwaki se siente amado! â¤ï¸",
    "Â¡CariÃ±os para Cakiwaki! ğŸ¤—",
    "Â¡Cakiwaki ronronea de felicidad! ğŸ˜º"
    ],
    levelUp: [
    "Â¡SubÃ­ de nivel! ğŸŠ",
    "Â¡Cada vez mÃ¡s fuerte! ğŸ’ª",
    "Â¡Mira lo grande que estoy! ğŸ“",
    "Â¡Gracias por cuidarme tan bien! ğŸ†",
    "Â¡Somos un gran equipo! ğŸ¤",
    "Â¡Cakiwaki evoluciona! ğŸŒŸ",
    "Â¡Nuevo nivel desbloqueado! ğŸ”“",
    "Â¡Cakiwaki se hace mÃ¡s poderoso! ğŸ’¥"
    ],
    random: [
    "Â¿Jugamos a algo? ğŸ²",
    "Tengo ganas de aventuras ğŸ—ºï¸",
    "Â¿Me cuentas un chiste? ğŸ˜†",
    "Â¿QuÃ© tal si bailamos? ğŸ’ƒ",
    "Me pregunto quÃ© habrÃ¡ en el cofre... ğŸ¤”",
    "Cakiwaki tiene una idea loca ğŸ’¡",
    "Â¿Y si aprendemos algo nuevo hoy? ğŸ“š",
    "Cakiwaki quiere explorar el mundo ğŸŒ",
    "Â¿Podemos hacer un picnic virtual? ğŸ§º",
    "Cakiwaki sueÃ±a con ser una estrella ğŸŒ "
    ],
    sick: [
    "Cakiwaki no se siente muy bien ğŸ¤’",
    "Â¿Puedes cuidar de Cakiwaki? ğŸ¤§",
    "Cakiwaki necesita descansar ğŸ˜´",
    "Un poco de medicina ayudarÃ­a ğŸ’Š",
    "Cakiwaki tiene escalofrÃ­os ğŸ¥¶"
    ]
    };
    
    // FunciÃ³n para obtener una frase aleatoria
    function getRandomPhrase(category) {
    return phrases[category][Math.floor(Math.random() * phrases[category].length)];
    }
    
    // Funciones principales
    function updateStatus() {
    hunger = Math.max(0, Math.min(100, hunger));
    fun = Math.max(0, Math.min(100, fun));
    hygiene = Math.max(0, Math.min(100, hygiene));
    
    hungerFill.style.width = `${hunger}%`;
    funFill.style.width = `${fun}%`;
    hygieneFill.style.width = `${hygiene}%`;
    
    currencyElement.textContent = `ğŸ’° ${currency}`;
    xpElement.textContent = `â­ ${xp}`;
    
    updatePetExpression();
    updatePetAppearance();
    }
    
    function updatePetExpression() {
    const currentTime = Date.now();
    if (currentTime - lastExpressionChangeTime < 10000) {
    return;
    }
    
    if (!isLightOn) {
    pet.textContent = 'ğŸ˜´';
    } else if (hunger <= 30 || fun <= 30 || hygiene <= 30) {
    pet.textContent = 'ğŸ˜¢';
    } else if (isSick) {
    pet.textContent = 'ğŸ¤’';
    } else {
    changePetFace();
    }
    }
    
    function changePetFace() {
    if (!isGameActive || !isLightOn) return;
    
    currentpetEmojiIndex = Math.floor(Math.random() * petEmojis.length);
    pet.textContent = petEmojis[currentpetEmojiIndex];
    
    const moveRange = 10;
    const randomX = (Math.random() - 0.5) * moveRange;
    const randomY = (Math.random() - 0.5) * moveRange;
    petContainer.style.transform = `translate(${randomX}px, ${randomY}px)`;
    }
    
    function decreaseStats() {
    if (!isGameActive) return;
    
    const decreaseAmount = isLightOn ? 3 : 1.5;
    
    hunger = Math.max(0, hunger - decreaseAmount);
    fun = Math.max(0, fun - decreaseAmount);
    hygiene = Math.max(0, hygiene - decreaseAmount);
    
    if (hunger <= 0) {
    addEventToBar("ğŸ’€ Cakiwaki ha muerto de hambre");
    petDeath();
    }
    
    randomSickness();
    updateStatus();
    updateFirestore();
    }
    
    function addEventToBar(message) {
    const eventIcon = document.createElement('div');
    eventIcon.classList.add('event-icon');
    eventIcon.textContent = message;
    eventBar.insertBefore(eventIcon, eventBar.firstChild);
    
    while (eventBar.childNodes.length > 2) {
    eventBar.removeChild(eventBar.lastChild);
    }
    }
    
    function changeWeather() {
    if (!isGameActive) return;
    
    currentWeatherIndex = (currentWeatherIndex + 1) % weatherEmojis.length;
    weatherElement.textContent = weatherEmojis[currentWeatherIndex];
    applyWeatherEffects();
    }
    
    function applyWeatherEffects() {
    switch(weatherEmojis[currentWeatherIndex]) {
    case 'â˜€ï¸':
    fun = Math.min(100, fun + 5);
    hygiene = Math.max(0, hygiene - 5);
    addEventToBar("â˜€ï¸ DÃ­a soleado, Â¡Cakiwaki quiere jugar afuera!");
    break;
    case 'ğŸŒ§ï¸':
    hygiene = Math.min(100, hygiene + 10);
    fun = Math.max(0, fun - 5);
    if (Math.random() < 0.2 && !isSick) {
    isSick = true;
    addEventToBar(getRandomPhrase('sick'));
    fun = Math.max(0, fun - 20);
    }
    addEventToBar("ğŸŒ§ï¸ DÃ­a lluvioso, Â¡Cakiwaki se da un baÃ±o natural!");
    break;
    case 'â„ï¸':
    hunger = Math.min(100, hunger + 10);
    if (Math.random() < 0.3 && !isSick) {
    isSick = true;
    addEventToBar(getRandomPhrase('sick'));
    }
    addEventToBar("â„ï¸ DÃ­a frÃ­o, Cakiwaki necesita mÃ¡s energÃ­a");
    break;
    case 'ğŸŒ¤ï¸':
    currency += 50;
    addEventToBar("ğŸŒ¤ï¸ğŸ’° DÃ­a despejado, Â¡Cakiwaki encontrÃ³ monedas brillando al sol!");
    break;
    case 'ğŸŒˆ':
    fun = Math.min(100, fun + 15);
    currency += 100;
    addEventToBar("ğŸŒˆğŸ’° Â¡ArcoÃ­ris! Cakiwaki estÃ¡ feliz y encontrÃ³ un tesoro");
    break;
    }
    updateStatus();
    updateFirestore();
    }
    
    function gainXP(amount) {
    xp += amount;
    if (xp >= level * 100) {
    levelUp();
    }
    updateStatus();
    updateFirestore();
    }
    
    function levelUp() {
    level++;
    xp = 0;
    addEventToBar(getRandomPhrase('levelUp'));
    currency += level * 50;
    updateStatus();
    updateFirestore();
    }
    
    feedBtn.addEventListener('click', () => {
    foodModal.style.display = 'block';
    updateFoodMenu();
    });
    
    playBtn.addEventListener('click', () => {
    miniGameModal.style.display = 'block';
    startRandomMiniGame();
    });
    
    cleanBtn.addEventListener('click', () => {
    cleanPet();
    });
    
    shopIcon.addEventListener('click', () => {
    shopModal.style.display = 'block';
    updateShop();
    });
    
    chest.addEventListener('click', () => {
    chestModal.style.display = 'block';
    updateChestItems();
    });
    
    closeChest.addEventListener('click', () => {
    chestModal.style.display = 'none';
    });
    
    pet.addEventListener('click', () => {
    lastUserInteractionTime = Date.now();
    changePetFace();
    
    if (!isLightOn) {
    isLightOn = true;
    lightSwitch.textContent = 'ğŸ’¡';
    addEventToBar("ğŸŒ Cakiwaki se despertÃ³");
    }
    
    tapCount++;
    if (tapCount >= 10) {
    fun = Math.min(100, fun + 5);
    addEventToBar(getRandomPhrase('caress'));
    gainXP(5);
    tapCount = 0;
    }
    
    clearTimeout(expressionTimeout);
    expressionTimeout = setTimeout(() => {
    updatePetExpression();
    }, 10000);
    
    updateStatus();
    updateFirestore();
    });
    
    function updateShop() {
    const shopItemsContainer = document.getElementById('shop-items');
    shopItemsContainer.innerHTML = '';
    shopItems.forEach(item => {
    const itemElement = document.createElement('div');
    itemElement.classList.add('shop-item');
    itemElement.innerHTML = `${item.emoji}<br>ğŸ’°${item.price}<br>Nivel ${item.requiredLevel}`;
    itemElement.onclick = () => buyItem(item);
    if (level < item.requiredLevel) {
    itemElement.style.opacity = '0.5';
    itemElement.style.cursor = 'not-allowed';
    }
    shopItemsContainer.appendChild(itemElement);
    });
    }
    
    function updateFoodMenu() {
    const foodItemsContainer = document.getElementById('food-items');
    foodItemsContainer.innerHTML = '';
    foodItems.forEach(item => {
    const itemElement = document.createElement('div');
    itemElement.classList.add('food-item');
    itemElement.innerHTML = `${item.emoji}<br>ğŸ’°${item.price}<br>Nivel ${item.requiredLevel}`;
    itemElement.onclick = () => feedPet(item);
    if (level < item.requiredLevel) {
    itemElement.style.opacity = '0.5';
    itemElement.style.cursor = 'not-allowed';
    }
    foodItemsContainer.appendChild(itemElement);
    });
    }
    
    function buyItem(item) {
    if (currency >= item.price && level >= item.requiredLevel) {
    currency -= item.price;
    switch(item.type) {
    case 'crown':
    case 'glasses':
    case 'hat':
    case 'topHat':
    const accessoryElement = document.getElementById(item.type);
    if (accessoryElement.textContent !== '') {
    chestItems.push(accessoryElement.textContent);
    }
    accessoryElement.textContent = item.emoji;
    break;
    case 'shampoo':
    shampooCount++;
    chestItems.push(item.emoji);
    break;
    case 'medicine':
    if (isSick) {
    isSick = false;
    addEventToBar("ğŸ’Šâœ… Cakiwaki se ha curado");
    } else {
    addEventToBar("ğŸ’ŠâŒ Cakiwaki no estÃ¡ enfermo");
    return;
    }
    break;
    }
    updateStatus();
    addEventToBar(`${item.emoji}âœ… Compra exitosa`);
    gainXP(10);
    updateFirestore();
    shopModal.style.display = 'none';
    } else if (level < item.requiredLevel) {
    addEventToBar(`âŒ Necesitas nivel ${item.requiredLevel}`);
    } else {
    addEventToBar("ğŸ’°âŒ No tienes suficientes monedas");
    }
    }
    
    function feedPet(food) {
    if (currency >= food.price && level >= food.requiredLevel) {
    currency -= food.price;
    if (!isGameActive) {
    isGameActive = true;
    hunger = 50;
    fun = 50;
    hygiene = 50;
    level = 1;
    xp = 0;
    addEventToBar("ğŸ‰ Cakiwaki ha revivido!");
    } else {
    hunger = Math.min(100, hunger + food.hunger);
    }
    addEventToBar(getRandomPhrase('feed'));
    gainXP(5);
    if (hunger > 100) {
    isSick = true;
    addEventToBar("ğŸ¤¢ Cakiwaki comiÃ³ demasiado");
    }
    updateStatus();
    updateFirestore();
    foodModal.style.display = 'none';
    } else if (level < food.requiredLevel) {
    addEventToBar(`âŒ Necesitas nivel ${food.requiredLevel}`);
    } else {
    addEventToBar("ğŸ’°âŒ No tienes suficientes monedas");
    }
    }
    
    function cleanPet() {
    if (shampooCount > 0) {
    hygiene = Math.min(100, hygiene + 40);
    shampooCount--;
    currency += 10;
    addEventToBar(getRandomPhrase('clean'));
    gainXP(5);
    
    document.querySelectorAll('.poop').forEach(poop => poop.remove());
    
    updateStatus();
    updateFirestore();
    } else {
    addEventToBar("âŒ No tienes shampoo");
    }
    }
    
    function startRandomMiniGame() {
    if (Math.random() < 0.5) {
    startCatchEmojiGame();
    } else {
    startFollowEmojiGame();
    }
    }
    
    function startCatchEmojiGame() {
    const miniGameBoard = document.getElementById('mini-game-board');
    miniGameBoard.innerHTML = '';
    miniGameBoard.style.gridTemplateColumns = 'repeat(4, 1fr)';
    miniGameBoard.style.gridTemplateRows = 'repeat(4, 1fr)';
    
    const targetEmoji = 'ğŸ¯';
    let score = 0;
    let timeLeft = 30;
    
    const scoreDisplay = document.createElement('div');
    scoreDisplay.textContent = `PuntuaciÃ³n: ${score}`;
    miniGameBoard.appendChild(scoreDisplay);
    
    const timeDisplay = document.createElement('div');
    timeDisplay.textContent = `Tiempo: ${timeLeft}s`;
    miniGameBoard.appendChild(timeDisplay);
    
    for (let i = 0; i < 16; i++) {
    const cell = document.createElement('div');
    cell.classList.add('mini-game-cell');
    miniGameBoard.appendChild(cell);
    }
    
    function placeTarget() {
    const cells = miniGameBoard.querySelectorAll('.mini-game-cell');
    cells.forEach(cell => {
    cell.textContent = '';
    cell.onclick = null;
    });
    const randomCell = cells[Math.floor(Math.random() * cells.length)];
    randomCell.textContent = targetEmoji;
    randomCell.onclick = () => {
    score++;
    gainXP(2);
    addEventToBar("ğŸ¯ Â¡Has alcanzado el objetivo!");
    scoreDisplay.textContent = `PuntuaciÃ³n: ${score}`;
    placeTarget();
    };
    }
    
    placeTarget();
    
    const timerInterval = setInterval(() => {
    timeLeft--;
    timeDisplay.textContent = `Tiempo: ${timeLeft}s`;
    if (timeLeft <= 0) {
    clearInterval(timerInterval);
    endCatchEmojiGame();
    }
    }, 1000);
    
    function endCatchEmojiGame() {
    addEventToBar(`ğŸ Fin del juego: PuntuaciÃ³n = ${score}`);
    fun = Math.min(100, fun + score * 2);
    currency += score * 10;
    gainXP(score);
    updateStatus();
    miniGameModal.style.display = 'none';
    updateFirestore();
    }
    }
    
    function startFollowEmojiGame() {
    const miniGameBoard = document.getElementById('mini-game-board');
    miniGameBoard.innerHTML = '';
    miniGameBoard.style.gridTemplateColumns = 'repeat(4, 1fr)';
    miniGameBoard.style.gridTemplateRows = 'repeat(4, 1fr)';
    
    const targetEmoji = 'ğŸ¯';
    let score = 0;
    let timeLeft = 30;
    let currentTargetCell = null;
    
    for (let i = 0; i < 16; i++) {
    const cell = document.createElement('div');
    cell.classList.add('grid-cell');
    miniGameBoard.appendChild(cell);
    }
    
    function placeTarget() {
    const cells = miniGameBoard.querySelectorAll('.grid-cell');
    cells.forEach(cell => cell.textContent = '');
    const randomIndex = Math.floor(Math.random() * cells.length);
    currentTargetCell = cells[randomIndex];
    currentTargetCell.textContent = targetEmoji;
    currentTargetCell.onclick = () => {
    score++;
    gainXP(2);
    addEventToBar("ğŸ¯ Â¡Has alcanzado el objetivo!");
    score++;
    placeTarget();
    };
    }
    
    placeTarget();
    
    const timerInterval = setInterval(() => {
    timeLeft--;
    if (timeLeft <= 0) {
    clearInterval(timerInterval);
    endFollowEmojiGame();
    }
    }, 1000);
    
    function endFollowEmojiGame() {
    addEventToBar(`ğŸ Fin del juego: PuntuaciÃ³n = ${score}`);
    fun = Math.min(100, fun + score * 2);
    currency += score * 10;
    gainXP(score);
    updateStatus();
    miniGameModal.style.display = 'none';
    updateFirestore();
    }
    }
    
    function updateChestItems() {
    chestItemsContainer.innerHTML = '';
    chestItems.forEach(item => {
    const itemElement = document.createElement('div');
    itemElement.classList.add('chest-item');
    itemElement.textContent = item;
    itemElement.onclick = () => equipItem(item);
    chestItemsContainer.appendChild(itemElement);
    });
    }
    
    function equipItem(item) {
    const accessoryType = getAccessoryType(item);
    if (accessoryType) {
    document.getElementById(accessoryType).textContent = item;
    chestItems = chestItems.filter(i => i !== item);
    updateChestItems();
    addEventToBar(`${item} equipado!`);
    gainXP(5);
    updateFirestore();
    } else if (item === 'ğŸ§´') {
    shampooCount++;
    chestItems = chestItems.filter(i => i !== item);
    updateChestItems();
    addEventToBar(`ğŸ§´ Shampoo aÃ±adido`);
    gainXP(2);
    updateFirestore();
    }
    }
    
    function getAccessoryType(emoji) {
    switch(emoji) {
    case 'ğŸ‘‘': return 'crown';
    case 'ğŸ‘“': return 'glasses';
    case 'ğŸ§¢': return 'hat';
    case 'ğŸ©': return 'topHat';
    default: return null;
    }
    }
    
    // Arrastrar y soltar accesorios
    let draggedItem = null;
    
    document.querySelectorAll('.pet-accessory').forEach(accessory => {
    accessory.addEventListener('dragstart', (e) => {
    draggedItem = e.target;
    e.dataTransfer.setData('text/plain', e.target.id);
    setTimeout(() => {
    e.target.style.opacity = '0.5';
    }, 0);
    });
    
    accessory.addEventListener('dragend', (e) => {
    e.target.style.opacity = '1';
    });
    });
    
    chest.addEventListener('dragover', (e) => e.preventDefault());
    chest.addEventListener('drop', (e) => {
    e.preventDefault();
    if (draggedItem) {
    const accessoryType = draggedItem.id;
    const accessoryEmoji = draggedItem.textContent;
    if (accessoryEmoji) {
    chestItems.push(accessoryEmoji);
    draggedItem.textContent = '';
    addEventToBar("ğŸ§³âœ… Accesorio guardado");
    gainXP(2);
    updateChestItems();
    updateFirestore();
    }
    draggedItem = null;
    }
    });
    
    // Cerrar modales
    document.querySelectorAll('.close').forEach(closeBtn => {
    closeBtn.onclick = function() {
    this.closest('.modal').style.display = 'none';
    }
    });
    
    window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
    event.target.style.display = 'none';
    }
    }
    
    function updatePetAppearance() {
    if (level >= 10) {
    pet.style.filter = 'drop-shadow(0 0 10px gold)';
    } else if (level >= 5) {
    pet.style.filter = 'drop-shadow(0 0 5px silver)';
    } else {
    pet.style.filter = 'none';
    }
    }
    
    function movePet() {
    if (!isGameActive) return;
    
    const moveRange = 10;
    const randomX = (Math.random() - 0.5) * moveRange;
    const randomY = (Math.random() - 0.5) * moveRange;
    petContainer.style.transform = `translate(${randomX}px, ${randomY}px)`;
    }
    
    function resizePet() {
    const containerSize = Math.min(petContainer.offsetWidth, petContainer.offsetHeight);
    pet.style.fontSize = `${containerSize * 0.6}px`;
    crown.style.fontSize = `${containerSize * 0.3}px`;
    glasses.style.fontSize = `${containerSize * 0.35}px`;
    hat.style.fontSize = `${containerSize * 0.3}px`;
    }
    
    window.addEventListener('resize', resizePet);
    
    function resetGame() {
    hunger = 50;
    fun = 100;
    hygiene = 100;
    currency = 2000;
    level = 1;
    xp = 0;
    isSick = false;
    caressCount = 0;
    chestItems = [];
    shampooCount = 0;
    crown.textContent = '';
    glasses.textContent = '';
    hat.textContent = '';
    petDocRef.set({
    hunger: hunger,
    fun: fun,
    hygiene: hygiene,
    currency: currency,
    level: level,
    xp: xp,
    isSick: isSick,
    caressCount: caressCount,
    chestItems: chestItems,
    shampooCount: shampooCount,
    isLightOn: isLightOn,
    currentBackground: currentBackground,
    accessories: {
    crown: crown.textContent,
    glasses: glasses.textContent,
    hat: hat.textContent
    }
    }).then(() => {
    addEventToBar("ğŸ”„âœ… Juego reiniciado");
    updateStatus();
    }).catch((error) => {
    console.error("Error al reiniciar el juego en Firebase:", error);
    addEventToBar("ğŸš¨ Error al reiniciar el juego.");
    });
    }
    
    function handleConnectionStatus() {
    const connectedRef = firebase.database().ref('.info/connected');
    connectedRef.on('value', (snap) => {
    if (snap.val() === true) {
    addEventToBar("âœ… Conectado a Firebase");
    } else {
    addEventToBar("ğŸ“¡ ConexiÃ³n perdida. Esperando reconexiÃ³n...");
    }
    });
    }
    
    petDocRef.onSnapshot((doc) => {
    if (doc.exists) {
    const data = doc.data();
    hunger = data.hunger;
    fun = data.fun;
    hygiene = data.hygiene;
    currency = data.currency;
    level = data.level;
    xp = data.xp;
    isSick = data.isSick;
    caressCount = data.caressCount;
    chestItems = data.chestItems || [];
    shampooCount = data.shampooCount;
    isLightOn = data.isLightOn;
    currentBackground = data.currentBackground;
    crown.textContent = data.accessories.crown;
    glasses.textContent = data.accessories.glasses;
    hat.textContent = data.accessories.hat;
    updateUI();
    } else {
    updateFirestore();
    }
    }, (error) => {
    console.error("Error al escuchar cambios en Firebase:", error);
    addEventToBar("ğŸš¨ Error de conexiÃ³n con Firebase.");
    });
    
    function updateFirestore() {
    petDocRef.set({
    hunger: hunger,
    fun: fun,
    hygiene: hygiene,
    currency: currency,
    level: level,
    xp: xp,
    isSick: isSick,
    caressCount: caressCount,
    chestItems: chestItems,
    shampooCount: shampooCount,
    isLightOn: isLightOn,
    currentBackground: currentBackground,
    accessories: {
    crown: crown.textContent,
    glasses: glasses.textContent,
    hat: hat.textContent
    }
    }).then(() => {
    console.log("Datos actualizados correctamente en Firebase");
    }).catch((error) => {
    console.error("Error al actualizar los datos en Firebase:", error);
    addEventToBar("ğŸš¨ Error al actualizar datos en Firebase.");
    });
    }
    
    function handleFirebaseError(error) {
    console.error("Error de Firebase:", error);
    addEventToBar("ğŸš¨ Error de conexiÃ³n. Por favor, intenta mÃ¡s tarde.");
    }
    
    function loadGame() {
    petDocRef.get().then((doc) => {
    if (doc.exists) {
    const data = doc.data();
    hunger = data.hunger;
    fun = data.fun;
    hygiene = data.hygiene;
    currency = data.currency;
    level = data.level;
    xp = data.xp;
    isSick = data.isSick;
    caressCount = data.caressCount;
    chestItems = data.chestItems || [];
    shampooCount = data.shampooCount;
    isLightOn = data.isLightOn;
    currentBackground = data.currentBackground;
    crown.textContent = data.accessories.crown;
    glasses.textContent = data.accessories.glasses;
    hat.textContent = data.accessories.hat;
    updateUI();
    } else {
    updateFirestore();
    }
    }).catch((error) => {
    console.error("Error al cargar el juego desde Firebase:", error);
    addEventToBar("ğŸš¨ Error al cargar el juego.");
    });
    }
    
    function generatePoop() {
    if (!isGameActive) return;
    const poop = document.createElement('div');
    poop.classList.add('poop');
    poop.textContent = 'ğŸ’©';
    const petFrame = document.querySelector('.pet-frame');
    const x = Math.random() * (petFrame.offsetWidth - 30);
    const y = Math.random() * (petFrame.offsetHeight - 30);
    poop.style.left = `${x}px`;
    poop.style.top = `${y}px`;
    petFrame.appendChild(poop);
    
    poop.addEventListener('click', () => {
    poop.remove();
    hygiene = Math.max(0, hygiene - 10);
    updateStatus();
    updateFirestore();
    });
    }
    
    function updateUI() {
    updateStatus();
    updateChestItems();
    background.style.background = backgrounds[currentBackground];
    lightSwitch.textContent = isLightOn ? 'ğŸ’¡' : 'ğŸŒ™';
    }
    
    function petDeath() {
    isGameActive = false;
    pet.textContent = Math.random() < 0.5 ? 'ğŸ’€' : 'ğŸ‘¹';
    addEventToBar("ğŸ’€ Cakiwaki ha muerto. Dale de comer para revivirlo.");
    }
    
    function randomSickness() {
    if (!isGameActive || isSick) return;
    
    if (Math.random() < 0.02) {
    isSick = true;
    addEventToBar(getRandomPhrase('sick'));
    fun = Math.max(0, fun - 20);
    updateStatus();
    updateFirestore();
    }
    }
    
    function randomEvent() {
    if (!isGameActive) return;
    
    const events = [
    { probability: 0.05, action: () => { addEventToBar("ğŸŒŸ Â¡Cakiwaki encontrÃ³ una moneda brillante!"); currency += 10; gainXP(5); updateFirestore(); } },
    { probability: 0.03, action: () => { addEventToBar(getRandomPhrase('random')); } },
    { probability: 0.02, action: () => { addEventToBar(getRandomPhrase('sick')); isSick = true; fun = Math.max(0, fun - 20); updateStatus(); updateFirestore(); } },
    { probability: 0.04, action: () => { addEventToBar("ğŸ Â¡Regalo sorpresa para Cakiwaki!"); xp += 20; gainXP(20); updateFirestore(); } },
    { probability: 0.02, action: () => { addEventToBar("ğŸ€ Â¡DÃ­a de suerte para Cakiwaki!"); fun = Math.min(100, fun + 15); gainXP(5); updateFirestore(); } },
    { probability: 0.01, action: () => { addEventToBar("ğŸ“š Cakiwaki aprendiÃ³ algo nuevo"); gainXP(15); updateFirestore(); } },
    { probability: 0.02, action: () => { addEventToBar("ğŸŒˆ Un arcoÃ­ris apareciÃ³ en el cielo"); currency += 30; gainXP(10); updateFirestore(); } },
    { probability: 0.01, action: () => { addEventToBar("ğŸˆ Cakiwaki encontrÃ³ un globo"); fun = Math.min(100, fun + 20); gainXP(5); updateFirestore(); } }
    ];
    
    events.forEach(event => {
    if (Math.random() < event.probability) {
    event.action();
    }
    });
    }
    
    function petRandomMessage() {
    if (!isGameActive || !isLightOn) return;
    addEventToBar(getRandomPhrase('random'));
    }
    
    function optimizePerformance() {
    function animate() {
    if (isGameActive) {
    movePet();
    }
    requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);
    
    let firebaseUpdateTimeout;
    function throttledFirebaseUpdate() {
    if (!firebaseUpdateTimeout) {
    firebaseUpdateTimeout = setTimeout(() => {
    updateFirestore();
    firebaseUpdateTimeout = null;
    }, 5000);
    }
    }
    
    window.updateFirestore = throttledFirebaseUpdate;
    }
    
    function manageMemory() {
    setInterval(() => {
    const poops = document.querySelectorAll('.poop');
    if (poops.length > 5) {
    poops[0].remove();
    }
    }, 60000);
    
    const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
    if (mutation.type === 'childList') {
    while (eventBar.childNodes.length > 10) {
    eventBar.removeChild(eventBar.firstChild);
    }
    }
    });
    });
    
    observer.observe(eventBar, { childList: true });
    }
    
    function init() {
    loadGame();
    updateStatus();
    resizePet();
    setInterval(decreaseStats, 15000);
    setInterval(changeWeather, 15000);
    setInterval(() => {
    if (isLightOn && isGameActive) {
    changePetFace();
    }
    }, Math.floor(Math.random() * 5000) + 3000);
    setInterval(movePet, 2000);
    setInterval(randomEvent, 60000);
    setInterval(petRandomMessage, 90000);
    setInterval(generatePoop, Math.floor(Math.random() * 50000) + 20000);
    background.style.background = backgrounds[currentBackground];
    handleConnectionStatus();
    optimizePerformance();
    manageMemory();
    }
    
    function resizeContent() {
    const gameContainer = document.querySelector('.game-container');
    const height = window.innerHeight;
    gameContainer.style.height = `${height}px`;
    
    window.parent.postMessage({ type: 'resize', height: height }, '*');
    }
    
    window.addEventListener('resize', resizeContent);
    
    document.addEventListener('DOMContentLoaded', () => {
    init();
    resizeContent();
    });
    
    window.addEventListener('message', (event) => {
    if (event.data === 'initializePet') {
    init();
    }
    });

  
        </script>
    </body>
    </html>
